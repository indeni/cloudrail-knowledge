AWSTemplateFormatVersion: "2010-09-09"

Resources:
  FileSystemTest:
    Type: AWS::EFS::FileSystem

  TaskDefinition:
    Type: AWS::ECS::TaskDefinition
    Properties:
      Family: "cloudrail-test-encryption"
      ContainerDefinitions:
        - Name: "first"
          #Image: "service-first"
          Image: "nginx:latest"
          Essential: true
          Memory: "512"
          Cpu: "10"
          PortMappings:
            - ContainerPort: 80
              HostPort: 80
        - Name: "second"
          #Image: "service-second"
          Image: "nginx:latest"
          Essential: true
          Memory: "512"
          Cpu: "10"
          PortMappings:
            - ContainerPort: 443
              HostPort: 443
      Volumes:
        - Name: "service-storage"
          EFSVolumeConfiguration:
            FilesystemId: !Ref FileSystemTest
            RootDirectory: "/opt/data"
            TransitEncryption: "ENABLED"
