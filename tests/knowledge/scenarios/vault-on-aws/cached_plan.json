{"format_version":"0.1","terraform_version":"0.12.29","variables":{"allowed_bastion_cidr_blocks":{"value":["0.0.0.0/0"]},"allowed_bastion_cidr_blocks_ipv6":{"value":[]},"allowed_traffic_cidr_blocks":{"value":["0.0.0.0/0"]},"allowed_traffic_cidr_blocks_ipv6":{"value":["::/0"]},"aws_default_region":{"value":"us-east-1"},"aws_profile":{"value":"default"},"domain_name":{"value":"secrets.domain.com"},"dynamodb_table_name":{"value":"vault_storage"},"ec2_key_pair_name":{"value":"vault_key_pair"},"kms_tags":{"value":{}},"main_project_tag":{"value":"vault-deployment"},"operator_mode":{"value":true},"peered_vpc_ids":{"value":[]},"private_mode":{"value":false},"use_lastest_ami":{"value":false},"vault_instance_count":{"value":2},"vault_instance_type":{"value":"t2.medium"},"vault_version":{"value":"1.4.0"},"vpc_cidr":{"value":"10.255.0.0/20"},"vpc_instance_tenancy":{"value":"default"},"vpc_private_subnet_count":{"value":2},"vpc_public_subnet_count":{"value":2},"vpc_tags":{"value":{}}},"planned_values":{"outputs":{"load_balancer_dns":{"sensitive":false,"value":"aws_lb.alb.dns_name"},"vpc_id":{"sensitive":false,"value":"aws_vpc.vault.id"},"vpc_ipv4_cidr":{"sensitive":false,"value":"10.255.0.0/20"},"vpc_ipv6_cidr":{"sensitive":false}},"root_module":{"resources":[{"address":"aws_autoscaling_group.vault-asg","mode":"managed","type":"aws_autoscaling_group","name":"vault-asg","provider_name":"aws","schema_version":0,"values":{"capacity_rebalance":null,"desired_capacity":2,"enabled_metrics":["GroupDesiredCapacity","GroupInServiceCapacity","GroupInServiceInstances","GroupMaxSize","GroupMinSize","GroupPendingCapacity","GroupPendingInstances","GroupStandbyCapacity","GroupStandbyInstances","GroupTerminatingCapacity","GroupTerminatingInstances","GroupTotalCapacity","GroupTotalInstances"],"force_delete":false,"health_check_grace_period":300,"health_check_type":"EC2","initial_lifecycle_hook":[],"instance_refresh":[],"launch_configuration":null,"launch_template":[{"id":"aws_launch_template.vault_instance.id"}],"load_balancers":null,"max_instance_lifetime":null,"max_size":2,"metrics_granularity":"1Minute","min_elb_capacity":null,"min_size":2,"mixed_instances_policy":[],"name_prefix":"vault-deployment-asg-","placement_group":null,"protect_from_scale_in":false,"suspended_processes":null,"tag":[],"tags":[{"key":"Name","propagate_at_launch":"true","value":"vault-deployment-instance"},{"key":"Project","propagate_at_launch":"true","value":"vault-deployment"}],"target_group_arns":["aws_lb_target_group.alb_targets.arn"],"termination_policies":["OldestLaunchTemplate"],"timeouts":null,"vpc_zone_identifier":["aws_subnet.private[0].id","aws_subnet.private[1].id"],"wait_for_capacity_timeout":"0","wait_for_elb_capacity":null}},{"address":"aws_dynamodb_table.vault_storage","mode":"managed","type":"aws_dynamodb_table","name":"vault_storage","provider_name":"aws","schema_version":1,"values":{"attribute":[{"name":"Key","type":"S"},{"name":"Path","type":"S"}],"billing_mode":"PAY_PER_REQUEST","global_secondary_index":[],"hash_key":"Path","local_secondary_index":[],"name":"vault_storage","range_key":"Key","read_capacity":null,"replica":[],"stream_enabled":null,"tags":{"Name":"vault_storage","Project":"vault-deployment"},"timeouts":null,"ttl":[],"write_capacity":null}},{"address":"aws_egress_only_internet_gateway.eigw","mode":"managed","type":"aws_egress_only_internet_gateway","name":"eigw","provider_name":"aws","schema_version":0,"values":{"tags":null,"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_eip.nat[0]","mode":"managed","type":"aws_eip","name":"nat","index":0,"provider_name":"aws","schema_version":0,"values":{"associate_with_private_ip":null,"customer_owned_ipv4_pool":null,"tags":{"Name":"vault-deployment-nat-eip","Project":"vault-deployment"},"timeouts":null,"vpc":true}},{"address":"aws_iam_instance_profile.vault_instance_profile","mode":"managed","type":"aws_iam_instance_profile","name":"vault_instance_profile","provider_name":"aws","schema_version":0,"values":{"name_prefix":"vault-deployment-instance-profile-","path":"/","role":"aws_iam_role.vault_instance.name"}},{"address":"aws_iam_role.vault_instance","mode":"managed","type":"aws_iam_role","name":"vault_instance","provider_name":"aws","schema_version":0,"values":{"assume_role_policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      }\n    }\n  ]\n}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name_prefix":"vault-deployment-instance-role-","path":"/","permissions_boundary":null,"tags":null}},{"address":"aws_iam_role_policy.vault_instance_dynamodb_policy","mode":"managed","type":"aws_iam_role_policy","name":"vault_instance_dynamodb_policy","provider_name":"aws","schema_version":0,"values":{"name_prefix":"vault-deployment-instance-dynamodb-policy-","policy":"data.aws_iam_policy_document.dynamodb_vault_policy.json","role":"aws_iam_role.vault_instance.id"}},{"address":"aws_iam_role_policy.vault_instance_kms_policy","mode":"managed","type":"aws_iam_role_policy","name":"vault_instance_kms_policy","provider_name":"aws","schema_version":0,"values":{"name_prefix":"vault-deployment-instance-kms-policy-","policy":"data.aws_iam_policy_document.kms_vault_policy.json","role":"aws_iam_role.vault_instance.id"}},{"address":"aws_iam_role_policy.vault_instance_s3_policy","mode":"managed","type":"aws_iam_role_policy","name":"vault_instance_s3_policy","provider_name":"aws","schema_version":0,"values":{"name_prefix":"vault-deployment-instance-s3-policy-","policy":"data.aws_iam_policy_document.s3_vault_policy.json","role":"aws_iam_role.vault_instance.id"}},{"address":"aws_instance.bastion[0]","mode":"managed","type":"aws_instance","name":"bastion","index":0,"provider_name":"aws","schema_version":1,"values":{"ami":"ami-0323c3dd2da7fb37d","associate_public_ip_address":true,"credit_specification":[],"disable_api_termination":null,"ebs_optimized":null,"get_password_data":false,"hibernation":null,"iam_instance_profile":null,"instance_initiated_shutdown_behavior":null,"instance_type":"t2.micro","key_name":"vault_key_pair","monitoring":null,"source_dest_check":true,"subnet_id":"aws_subnet.public[0].id","tags":{"Name":"vault-deployment-bastion","Project":"vault-deployment"},"timeouts":null,"user_data":null,"user_data_base64":null,"volume_tags":null,"vpc_security_group_ids":["aws_security_group.bastion.id"]}},{"address":"aws_internet_gateway.igw","mode":"managed","type":"aws_internet_gateway","name":"igw","provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"vault-deployment-igw","Project":"vault-deployment"},"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_kms_alias.seal","mode":"managed","type":"aws_kms_alias","name":"seal","provider_name":"aws","schema_version":0,"values":{"name":"alias/vault-deployment-seal-key","name_prefix":null,"target_key_id":"aws_kms_key.seal.key_id"}},{"address":"aws_kms_key.seal","mode":"managed","type":"aws_kms_key","name":"seal","provider_name":"aws","schema_version":0,"values":{"customer_master_key_spec":"SYMMETRIC_DEFAULT","deletion_window_in_days":null,"description":"The KMS key to unseal Vault.","enable_key_rotation":true,"is_enabled":true,"key_usage":"ENCRYPT_DECRYPT","tags":{"Name":"vault-deployment-seal-key","Project":"vault-deployment"}}},{"address":"aws_launch_template.vault_instance","mode":"managed","type":"aws_launch_template","name":"vault_instance","provider_name":"aws","schema_version":0,"values":{"block_device_mappings":[],"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"description":null,"disable_api_termination":null,"ebs_optimized":null,"elastic_gpu_specifications":[],"elastic_inference_accelerator":[],"enclave_options":[],"hibernation_options":[],"iam_instance_profile":[{"arn":"aws_iam_instance_profile.vault_instance_profile.arn","name":null}],"image_id":"ami-0323c3dd2da7fb37d","instance_initiated_shutdown_behavior":null,"instance_market_options":[],"instance_type":"t2.medium","kernel_id":null,"key_name":"vault_key_pair","license_specification":[],"monitoring":[],"name_prefix":"vault-deployment-lt-","network_interfaces":[],"placement":[],"ram_disk_id":null,"security_group_names":null,"tag_specifications":[{"resource_type":"instance","tags":{"Name":"vault-deployment-instance","Project":"vault-deployment"}},{"resource_type":"volume","tags":{"Name":"vault-deployment-volume","Project":"vault-deployment"}}],"tags":{"Name":"vault-deployment-lt","Project":"vault-deployment"},"update_default_version":null,"user_data":"Q29udGVudC1UeXBlOiBtdWx0aXBhcnQvbWl4ZWQ7IGJvdW5kYXJ5PSI9PUJPVU5EQVJZPT0iCk1JTUUtVmVyc2lvbjogMS4wCgotLT09Qk9VTkRBUlk9PQpDb250ZW50LVR5cGU6IHRleHQveC1zaGVsbHNjcmlwdDsgY2hhcnNldD0idXMtYXNjaWkiCgojIS9iaW4vYmFzaApzZXQgLWUKCiMgUnVuIE9yZGVyOiAxCiMgUnVuIEZyZXF1ZW5jeTogb25seSBvbmNlLCBvbiBmaXJzdCBib290CgojIFRhc2tzOgojIC0gSW5zdGFsbCBEZXBlbmRlbmNpZXMKIyAtIE1ha2UgdXNlcnMgYW5kIGRpcmVjdG9yaWVzCiMgLSBJbnN0YWxsIGRvd25sb2FkLCB1bnppcCwgYW5kIHNldHVwIHZhdWx0IGJpbgoKIyBOb3RlOiBkb2xsYXItc2lnbiBjdXJseSBicmFjZXMgYXJlIHRlbXBsYXRlIHZhbHVlcyBmcm9tIFRlcnJhZm9ybS4KIyBOb24gY3VybHkgYnJhY2Ugb25lcyBhcmUgbm9ybWFsIGJhc2ggdmFyaWFibGVzLi4uCgp5dW0gdXBkYXRlIC15Cnl1bSBpbnN0YWxsIC15IGpxCgojIE1ha2UgdGhlIHVzZXIKdXNlcmFkZCAtLXN5c3RlbSAtLXNoZWxsIC9zYmluL25vbG9naW4gdmF1bHQKCiMgTWFrZSB0aGUgZGlyZWN0b3JpZXMKbWtkaXIgLXAgL29wdC92YXVsdApta2RpciAtcCAvb3B0L3ZhdWx0L2Jpbgpta2RpciAtcCAvb3B0L3ZhdWx0L2NvbmZpZwpta2RpciAtcCAvb3B0L3ZhdWx0L3RscwoKIyBHaXZlIGNvcnJldCBwZXJtaXNzaW9ucwpjaG1vZCA3NTUgL29wdC92YXVsdApjaG1vZCA3NTUgL29wdC92YXVsdC9iaW4KCiMgQ2hhbmdlIG93bmVyc2hpcCB0byB2YXVsdCB1c2VyCmNob3duIC1SIHZhdWx0OnZhdWx0IC9vcHQvdmF1bHQKCiMgR2V0IHRoZSBIYXNoaUNvcnAgUEdQCmN1cmwgaHR0cHM6Ly9rZXliYXNlLmlvL2hhc2hpY29ycC9wZ3Bfa2V5cy5hc2MgfCBncGcgLS1pbXBvcnQKCiMgRG93bmxvYWQgdmF1bHQgYW5kIHNpZ25hdHVyZXMKY3VybCAtT3MgaHR0cHM6Ly9yZWxlYXNlcy5oYXNoaWNvcnAuY29tL3ZhdWx0LzEuNC4wL3ZhdWx0XzEuNC4wX2xpbnV4X2FtZDY0LnppcApjdXJsIC1PcyBodHRwczovL3JlbGVhc2VzLmhhc2hpY29ycC5jb20vdmF1bHQvMS40LjAvdmF1bHRfMS40LjBfU0hBMjU2U1VNUwpjdXJsIC1PcyBodHRwczovL3JlbGVhc2VzLmhhc2hpY29ycC5jb20vdmF1bHQvMS40LjAvdmF1bHRfMS40LjBfU0hBMjU2U1VNUy5zaWcKCiMgVmVyaWZ5IFNpZ25hdHJlcwpncGcgLS12ZXJpZnkgdmF1bHRfMS40LjBfU0hBMjU2U1VNUy5zaWcgdmF1bHRfMS40LjBfU0hBMjU2U1VNUwpjYXQgdmF1bHRfMS40LjBfU0hBMjU2U1VNUyB8IGdyZXAgdmF1bHRfMS40LjBfbGludXhfYW1kNjQuemlwIHwgc2hhMjU2c3VtIC1jCgojIHVuemlwIGFuZCBtb3ZlIHRvIC9vcHQvdmF1bHQvYmluCnVuemlwIHZhdWx0XzEuNC4wX2xpbnV4X2FtZDY0LnppcAptdiB2YXVsdCAvb3B0L3ZhdWx0L2JpbgoKIyBnaXZlIG93bmVyc2hpcCB0byB0aGUgdmF1bHQgdXNlcgpjaG93biB2YXVsdDp2YXVsdCAvb3B0L3ZhdWx0L2Jpbi92YXVsdAoKIyBjcmVhdGUgYSBzeW1saW5rCmxuIC1zIC9vcHQvdmF1bHQvYmluL3ZhdWx0IC91c3IvbG9jYWwvYmluL3ZhdWx0CgojIGFsbG93IHZhdWx0IHBlcm1pc3Npb25zIHRvIHVzZSBtbG9jayBhbmQgcHJldmVudCBtZW1vcnkgZnJvbSBzd2FwcGluZyB0byBkaXNrCnNldGNhcCBjYXBfaXBjX2xvY2s9K2VwIC9vcHQvdmF1bHQvYmluL3ZhdWx0CgojIGNsZWFudXAgZmlsZXMKcm0gdmF1bHRfMS40LjBfbGludXhfYW1kNjQuemlwCnJtIHZhdWx0XzEuNC4wX1NIQTI1NlNVTVMKcm0gdmF1bHRfMS40LjBfU0hBMjU2U1VNUy5zaWcKCi0tPT1CT1VOREFSWT09CkNvbnRlbnQtVHlwZTogdGV4dC94LXNoZWxsc2NyaXB0OyBjaGFyc2V0PSJ1cy1hc2NpaSIKCiMhL2Jpbi9iYXNoCnNldCAtZQoKIyBSdW4gT3JkZXI6IDIKIyBSdW4gRnJlcXVlbmN5OiBvbmx5IG9uY2UsIG9uIGZpcnN0IGJvb3QKCiMgVGFza3M6CiMgLSBGZXRjaCBuZWVkZWQgZGF0YQojIC0gQ3JlYXRlIFNlbGYtU2lnbmVkIENlcnRpZmljYXRlIGFuZCBLZXkKCklOU1RBTkNFX0lQX0FERFI9JChjdXJsIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9sb2NhbC1pcHY0KQpJTlNUQU5DRV9ETlNfTkFNRT0kKGN1cmwgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWhvc3RuYW1lKQoKIyBVc2VkIGZvciBlbmNyeXB0aW9uIGJldHdlZW4gdGhlIGxvYWQgYmFsYW5jZXIgYW5kIHZhdWx0IGluc3RhbmNlcy4KIyBUaCBvdGhlciBhbHRlcm5hdGl2ZXMgYXJlIGVpdGhlciBjcmVhdGluZyBhbiBlbnRpcmUsIHByaXZhdGUgQ0EgYW5kIGhvcGluZyBBV1MKIyBldmVudHVhbGx5IGFkZHMgdGhlIGFiaWxpdHkgdG8gYWRkIHRydXN0ZWQgQ0FzIHRvIGxvYWQgYmFsYW5jZXJzLi4uCiMgLi4ub3IgcGF5aW5nICQ0MDAvbW9udGggYmFzZSBmb3IgdGhlIEFDTSBwcml2YXRlIENBLgpvcGVuc3NsIHJlcSAteDUwOSAtc2hhMjU2IC1ub2RlcyBcCiAgLW5ld2tleSByc2E6NDA5NiAtZGF5cyAzNjUwIFwKICAta2V5b3V0IC9vcHQvdmF1bHQvdGxzL3ZhdWx0LmtleSAtb3V0IC9vcHQvdmF1bHQvdGxzL3ZhdWx0LmNydCBcCiAgLXN1YmogIi9DTj0kSU5TVEFOQ0VfRE5TX05BTUUiIFwKICAtZXh0ZW5zaW9ucyBzYW4gXAogIC1jb25maWcgPChjYXQgL2V0Yy9wa2kvdGxzL29wZW5zc2wuY25mIDwoZWNobyAtZSAiXG5bc2FuXVxuc3ViamVjdEFsdE5hbWU9RE5TOiRJTlNUQU5DRV9ETlNfTkFNRSxJUDokSU5TVEFOQ0VfSVBfQUREUiIpKQoKY2hvd24gdmF1bHQ6dmF1bHQgL29wdC92YXVsdC90bHMvdmF1bHQua2V5CmNob3duIHZhdWx0OnZhdWx0IC9vcHQvdmF1bHQvdGxzL3ZhdWx0LmNydAoKY2htb2QgNjQwIC9vcHQvdmF1bHQvdGxzL3ZhdWx0LmtleQpjaG1vZCA2NDQgL29wdC92YXVsdC90bHMvdmF1bHQuY3J0CgojIFRydXN0IHRoZSBjZXJ0aWZpY2F0ZQpjcCAvb3B0L3ZhdWx0L3Rscy92YXVsdC5jcnQgL2V0Yy9wa2kvdGxzL2NlcnRzL3ZhdWx0LmNydAoKLS09PUJPVU5EQVJZPT0KQ29udGVudC1UeXBlOiB0ZXh0L3gtc2hlbGxzY3JpcHQ7IGNoYXJzZXQ9InVzLWFzY2lpIgoKIyEvYmluL2Jhc2gKc2V0IC1lCgojIFJ1biBPcmRlcjogMwojIFJ1biBGcmVxdWVuY3k6IG9ubHkgb25jZSwgb24gZmlyc3QgYm9vdAoKIyBUYXNrczoKIyAtIE1ha2UgdGhlIHZhdWx0IGNvbmZpZyBmaWxlCiMgLSBNYWtlIHRoZSBzeXN0ZW1kIHNlcnZpY2UgZmlsZQoKIyBUaGUgdmF1bHQgY29uZmlnIGZpbGUKY2F0ID4gL29wdC92YXVsdC9jb25maWcvc2VydmVyLmhjbCA8PC0gRU9GCmNsdXN0ZXJfbmFtZSA9ICJ2YXVsdC1kZXBsb3ltZW50IgptYXhfbGVhc2VfdHRsID0gIjE5MmgiCmRlZmF1bHRfbGVhc2VfdHRsID0gIjE5MmgiCnVpICA9ICJ0cnVlIgoKIyBXaGVyZSBjYW4gdGhlIFZhdWx0IEFQSSBiZSByZWFjaGVkPyAgQXQgRE5TIGZvciB0aGUgbG9hZCBiYWxhbmNlciwgb3IgdGhlIENOQU1FIGNyZWF0ZWQuCiMgTm90ZTogdGhpcyBtYXBzIHRvIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSBWQVVMVF9BUElfQUREUiBub3QgVkFVTFRfQUREUgphcGlfYWRkciA9ICJodHRwczovL3NlY3JldHMuZG9tYWluLmNvbSIKCiMgRm9yIGZvcndhcmRpbmcgYmV0d2VlbiB2YXVsdCBzZXJ2ZXJzLiAgU2V0IHRvIG93biBpcC4KY2x1c3Rlcl9hZGRyID0gImh0dHBzOi8vSU5TVEFOQ0VfSVBfQUREUjo4MjAxIgoKIyBBdXRvIHVuc2VhbCB0aGUgdmF1bHQKc2VhbCAiYXdza21zIiB7CiAgcmVnaW9uID0gInVzLWVhc3QtMSIKICBrbXNfa2V5X2lkID0gImF3c19rbXNfa2V5LnNlYWwua2V5X2lkIgp9CgojIExpc3RlbmVyIGZvciBsb29wYmFjawpsaXN0ZW5lciAidGNwIiB7CiAgYWRkcmVzcyA9ICIxMjcuMC4wLjE6ODE5OSIKICB0bHNfZGlzYWJsZSA9ICJ0cnVlIgp9CgojIExpc3RlbmVyIGZvciBwcml2YXRlIG5ldHdvcmsKbGlzdGVuZXIgInRjcCIgewogIGFkZHJlc3MgPSAiSU5TVEFOQ0VfSVBfQUREUjo4MjAwIgogIGNsdXN0ZXJfYWRkcmVzcyA9ICJJTlNUQU5DRV9JUF9BRERSOjgyMDEiCgogIHRsc19kaXNhYmxlID0gImZhbHNlIgogIHRsc19jZXJ0X2ZpbGUgPSAiL29wdC92YXVsdC90bHMvdmF1bHQuY3J0IgogIHRsc19rZXlfZmlsZSA9ICIvb3B0L3ZhdWx0L3Rscy92YXVsdC5rZXkiCn0KCnN0b3JhZ2UgImR5bmFtb2RiIiB7CiAgaGFfZW5hYmxlZCA9ICJ0cnVlIgogIHJlZ2lvbiA9ICJ1cy1lYXN0LTEiCiAgdGFibGUgPSAidmF1bHRfc3RvcmFnZSIKfQpFT0YKCmNob3duIHZhdWx0OnZhdWx0IC9vcHQvdmF1bHQvY29uZmlnL3NlcnZlci5oY2wKCiMgVGhlIHN5c3RlbWQgc2VydmljZSBmaWxlCmNhdCA+IC9ldGMvc3lzdGVtZC9zeXN0ZW0vdmF1bHQuc2VydmljZSA8PC0gRU9GCltVbml0XQpEZXNjcmlwdGlvbj1WYXVsdCBTZXJ2ZXIgb24gQVdTClJlcXVpcmVzPW5ldHdvcmstb25saW5lLnRhcmdldApBZnRlcj1uZXR3b3JrLW9ubGluZS50YXJnZXQKCltTZXJ2aWNlXQpVc2VyPXZhdWx0Ckdyb3VwPXZhdWx0ClByb3RlY3RTeXN0ZW09ZnVsbApQcm90ZWN0SG9tZT1yZWFkLW9ubHkKUHJpdmF0ZVRtcD15ZXMKUHJpdmF0ZURldmljZXM9eWVzClNlY3VyZUJpdHM9a2VlcC1jYXBzCkFtYmllbnRDYXBhYmlsaXRpZXM9Q0FQX0lQQ19MT0NLCkNhcGFiaWxpdGllcz1DQVBfSVBDX0xPQ0srZXAKQ2FwYWJpbGl0eUJvdW5kaW5nU2V0PUNBUF9TWVNMT0cgQ0FQX0lQQ19MT0NLCk5vTmV3UHJpdmlsZWdlcz15ZXMKRXhlY1N0YXJ0PS9vcHQvdmF1bHQvYmluL3ZhdWx0IHNlcnZlciAtY29uZmlnPS9vcHQvdmF1bHQvY29uZmlnLyAtbG9nLWxldmVsPWluZm8KRXhlY1JlbG9hZD0vYmluL2tpbGwgLS1zaWduYWwgSFVQIFwkTUFJTlBJRApLaWxsTW9kZT1wcm9jZXNzCktpbGxTaWduYWw9U0lHSU5UClJlc3RhcnQ9b24tZmFpbHVyZQpSZXN0YXJ0U2VjPTUKVGltZW91dFN0b3BTZWM9MzAKU3RhcnRMaW1pdEludGVydmFsPTYwClN0YXJ0TGltaXRCdXJzdD0zCkxpbWl0Tk9GSUxFPTY1NTM2CgpbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQKRU9GCgotLT09Qk9VTkRBUlk9PQpDb250ZW50LVR5cGU6IHRleHQveC1zaGVsbHNjcmlwdDsgY2hhcnNldD0idXMtYXNjaWkiCgojIS9iaW4vYmFzaApzZXQgLWUKCiMgUnVuIE9yZGVyOiA0CiMgUnVuIEZyZXF1ZW5jeTogb25seSBvbmNlLCBvbiBmaXJzdCBib290CgojIFRhc2tzOgojIC0gUmVwbGFjZSB2YWx1ZXMgaW4gY29uZmlndXJhdGlvbiBmaWxlcyB3aXRoIGluc3RhbmNlIG1ldGFkYXRhCiMgLSBTdGFydCB2YXVsdAoKSU5TVEFOQ0VfSVBfQUREUj0kKGN1cmwgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWlwdjQpCnNlZCAtaSAtZSAicy9JTlNUQU5DRV9JUF9BRERSLyRJTlNUQU5DRV9JUF9BRERSL2ciIC9vcHQvdmF1bHQvY29uZmlnL3NlcnZlci5oY2wKCnN5c3RlbWN0bCBkYWVtb24tcmVsb2FkCnN5c3RlbWN0bCBlbmFibGUgdmF1bHQKc3lzdGVtY3RsIHJlc3RhcnQgdmF1bHQKCi0tPT1CT1VOREFSWT09CkNvbnRlbnQtVHlwZTogdGV4dC94LXNoZWxsc2NyaXB0OyBjaGFyc2V0PSJ1cy1hc2NpaSIKCiMhL2Jpbi9iYXNoCnNldCAtZQoKIyBSdW4gT3JkZXI6IDUKIyBSdW4gRnJlcXVlbmN5OiBvbmx5IG9uY2UsIG9uIGZpcnN0IGJvb3QKCiMgVGFza3M6CiMgLSBJbml0aWFsaXplIFZhdWx0CiMgLSBDcmVhdGUgY3JlZGVudGlhbHMgZmlsZQojIC0gRW5jcnlwdCB0aGUgZmlsZSB2aWEgS01TCiMgLSBTZW5kIHRoZSBmaWxlIHRvIFMzCiMgLSBEZWxldGUgdGhlIGxvY2FsIGZpbGUKIyAtIEVyYXNlIGJhc2ggaGlzdG9yeQoKIyBXb3JrYXJvdW5kIHRvIG1ha2Ugc3VyZSB0aGUgdmF1bHQgc2VydmljZSBpcyBmdWxseSBpbml0aWFsaXplZC4Kc2xlZXAgMjAKCmV4cG9ydCBWQVVMVF9BRERSPSJodHRwOi8vMTI3LjAuMC4xOjgxOTkiCmV4cG9ydCBBV1NfREVGQVVMVF9SRUdJT049InVzLWVhc3QtMSIKZXhwb3J0IFZBVUxUX0lOSVRJQUxJWkVEPSQodmF1bHQgb3BlcmF0b3IgaW5pdCAtc3RhdHVzKSAjIGF2b2lkIG5vbi16ZXJvIGV4aXQgc3RhdHVzCgpmdW5jdGlvbiBpbml0aWFsaXplX3ZhdWx0IHsKICAjIGluaXRpYWxpemUgYW5kIHBpcGUgdG8gZmlsZQogIHZhdWx0IG9wZXJhdG9yIGluaXQgPiB2YXVsdF9jcmVkZW50aWFscy50eHQKCiAgIyBlbmNyeXB0IGl0IHdpdGggdGhlIEtNUyBrZXkKICBhd3Mga21zIGVuY3J5cHQgLS1rZXktaWQgYXdzX2ttc19rZXkuc2VhbC5rZXlfaWQgLS1wbGFpbnRleHQgZmlsZWI6Ly92YXVsdF9jcmVkZW50aWFscy50eHQgLS1vdXRwdXQgdGV4dCAtLXF1ZXJ5IENpcGhlcnRleHRCbG9iIHwgYmFzZTY0IC0tZGVjb2RlID4gdmF1bHRfY3JlZHNfZW5jcnlwdGVkCgogICMgc2VuZCB0aGUgZW5jcnlwdGVkIGZpbGUgdG8gdGhlIHMzIGJ1Y2tldAogIGF3cyBzMyBjcCB2YXVsdF9jcmVkc19lbmNyeXB0ZWQgczM6Ly9hd3NfczNfYnVja2V0LnZhdWx0X2RhdGEuaWQvCgogICMgY2xlYW51cAogIHJtIHZhdWx0X2NyZWRlbnRpYWxzLnR4dAogIHJtIHZhdWx0X2NyZWRzX2VuY3J5cHRlZAogIGhpc3RvcnkgLWMKICBoaXN0b3J5IC13Cn0KCmlmIFsgIiRWQVVMVF9JTklUSUFMSVpFRCIgPSAiVmF1bHQgaXMgaW5pdGlhbGl6ZWQiIF07IHRoZW4KICBlY2hvICJWYXVsdCBpcyBhbHJlYWR5IGluaXRpYWxpemVkLiIKZWxzZQogIGVjaG8gIkluaXRpYWxpemluZyB2YXVsdC4uLiIKICBpbml0aWFsaXplX3ZhdWx0CmZpCgotLT09Qk9VTkRBUlk9PS0t","vpc_security_group_ids":["aws_security_group.vault_instance.id"]}},{"address":"aws_lb.alb","mode":"managed","type":"aws_lb","name":"alb","provider_name":"aws","schema_version":0,"values":{"access_logs":[],"customer_owned_ipv4_pool":null,"drop_invalid_header_fields":false,"enable_cross_zone_load_balancing":null,"enable_deletion_protection":false,"enable_http2":true,"idle_timeout":60,"internal":false,"ip_address_type":"dualstack","load_balancer_type":"application","name_prefix":"vault-","security_groups":["aws_security_group.load_balancer.id"],"subnets":["aws_subnet.public[0].id","aws_subnet.public[1].id"],"tags":{"Name":"vault-deployment-alb","Project":"vault-deployment"},"timeouts":null}},{"address":"aws_lb_listener.alb_http_redirect","mode":"managed","type":"aws_lb_listener","name":"alb_http_redirect","provider_name":"aws","schema_version":0,"values":{"certificate_arn":null,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"redirect":[{"host":"#{host}","path":"/#{path}","port":"443","protocol":"HTTPS","query":"#{query}","status_code":"HTTP_301"}],"target_group_arn":null,"type":"redirect"}],"load_balancer_arn":"aws_lb.alb.arn","port":80,"protocol":"HTTP","timeouts":null}},{"address":"aws_lb_listener.alb_https","mode":"managed","type":"aws_lb_listener","name":"alb_https","provider_name":"aws","schema_version":0,"values":{"certificate_arn":null,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"redirect":[],"target_group_arn":"aws_lb_target_group.alb_targets.arn","type":"forward"}],"load_balancer_arn":"aws_lb.alb.arn","port":443,"protocol":"HTTPS","ssl_policy":"ELBSecurityPolicy-FS-2018-06","timeouts":null}},{"address":"aws_lb_target_group.alb_targets","mode":"managed","type":"aws_lb_target_group","name":"alb_targets","provider_name":"aws","schema_version":0,"values":{"deregistration_delay":30,"health_check":[{"enabled":true,"healthy_threshold":3,"interval":10,"matcher":"200","path":"/v1/sys/health","port":"traffic-port","protocol":"HTTPS","timeout":5,"unhealthy_threshold":3}],"lambda_multi_value_headers_enabled":false,"name_prefix":"vault-","port":8200,"protocol":"HTTPS","proxy_protocol_v2":false,"slow_start":0,"tags":{"Name":"vault-deployment-tg","Project":"vault-deployment"},"target_type":"instance","vpc_id":"aws_vpc.vault.id"}},{"address":"aws_nat_gateway.nat[0]","mode":"managed","type":"aws_nat_gateway","name":"nat","index":0,"provider_name":"aws","schema_version":0,"values":{"allocation_id":"aws_eip.nat[0].id","subnet_id":"aws_subnet.public[0].id","tags":{"Name":"vault-deployment-nat","Project":"vault-deployment"}}},{"address":"aws_route.private_internet_access[0]","mode":"managed","type":"aws_route","name":"private_internet_access","index":0,"provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"nat_gateway_id":"aws_nat_gateway.nat[0].id","route_table_id":"aws_route_table.private.id","timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null}},{"address":"aws_route.private_internet_access_ipv6[0]","mode":"managed","type":"aws_route","name":"private_internet_access_ipv6","index":0,"provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":null,"destination_ipv6_cidr_block":"::/0","egress_only_gateway_id":"aws_egress_only_internet_gateway.eigw.id","route_table_id":"aws_route_table.private.id","timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null}},{"address":"aws_route.public_internet_access","mode":"managed","type":"aws_route","name":"public_internet_access","provider_name":"aws","schema_version":0,"values":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"gateway_id":"aws_internet_gateway.igw.id","route_table_id":"aws_route_table.public.id","timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null}},{"address":"aws_route_table.private","mode":"managed","type":"aws_route_table","name":"private","provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"vault-deployment-private-rtb","Project":"vault-deployment"},"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_route_table.public","mode":"managed","type":"aws_route_table","name":"public","provider_name":"aws","schema_version":0,"values":{"tags":{"Name":"vault-deployment-public-rtb","Project":"vault-deployment"},"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_route_table_association.private[0]","mode":"managed","type":"aws_route_table_association","name":"private","index":0,"provider_name":"aws","schema_version":0,"values":{"gateway_id":null,"route_table_id":"aws_route_table.private.id","subnet_id":"aws_subnet.private[0].id"}},{"address":"aws_route_table_association.private[1]","mode":"managed","type":"aws_route_table_association","name":"private","index":1,"provider_name":"aws","schema_version":0,"values":{"gateway_id":null,"route_table_id":"aws_route_table.private.id","subnet_id":"aws_subnet.private[1].id"}},{"address":"aws_route_table_association.public[0]","mode":"managed","type":"aws_route_table_association","name":"public","index":0,"provider_name":"aws","schema_version":0,"values":{"gateway_id":null,"route_table_id":"aws_route_table.public.id","subnet_id":"aws_subnet.public[0].id"}},{"address":"aws_route_table_association.public[1]","mode":"managed","type":"aws_route_table_association","name":"public","index":1,"provider_name":"aws","schema_version":0,"values":{"gateway_id":null,"route_table_id":"aws_route_table.public.id","subnet_id":"aws_subnet.public[1].id"}},{"address":"aws_s3_bucket.vault_data","mode":"managed","type":"aws_s3_bucket","name":"vault_data","provider_name":"aws","schema_version":0,"values":{"acl":"private","bucket_prefix":"vault-deployment-","cors_rule":[],"force_destroy":false,"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"policy":null,"replication_configuration":[],"server_side_encryption_configuration":[{"rule":[{"apply_server_side_encryption_by_default":[{"kms_master_key_id":null,"sse_algorithm":"AES256"}]}]}],"tags":{"Project":"vault-deployment"},"website":[]}},{"address":"aws_s3_bucket_public_access_block.vault_data","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"vault_data","provider_name":"aws","schema_version":0,"values":{"block_public_acls":true,"block_public_policy":true,"bucket":"aws_s3_bucket.vault_data.id","ignore_public_acls":true,"restrict_public_buckets":true}},{"address":"aws_security_group.bastion","mode":"managed","type":"aws_security_group","name":"bastion","provider_name":"aws","schema_version":1,"values":{"description":"Firewall for the operator bastion instance","name_prefix":"vault-deployment-bastion-sg","revoke_rules_on_delete":false,"tags":{"Name":"vault-deployment-bastion-sg","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_security_group.kms_endpoint","mode":"managed","type":"aws_security_group","name":"kms_endpoint","provider_name":"aws","schema_version":1,"values":{"description":"Firewall for the KMS Endpoint.","name_prefix":"vault-deployment-kms-endpoint-sg","revoke_rules_on_delete":false,"tags":{"Name":"vault-deployment-kms-endpoint-sg","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_security_group.load_balancer","mode":"managed","type":"aws_security_group","name":"load_balancer","provider_name":"aws","schema_version":1,"values":{"description":"Firewall for the application load balancer fronting the vault instances.","name_prefix":"vault-deployment-alb-sg","revoke_rules_on_delete":false,"tags":{"Name":"vault-deployment-alb-sg","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_security_group.vault_instance","mode":"managed","type":"aws_security_group","name":"vault_instance","provider_name":"aws","schema_version":1,"values":{"description":"Firewall for the vault instances.","name_prefix":"vault-deployment-vault-instance-sg","revoke_rules_on_delete":false,"tags":{"Name":"vault-deployment-vault-instance-sg","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_security_group_rule.bastion_allow_22","mode":"managed","type":"aws_security_group_rule","name":"bastion_allow_22","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow SSH traffic.","from_port":22,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.bastion.id","self":false,"to_port":22,"type":"ingress"}},{"address":"aws_security_group_rule.bastion_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"bastion_allow_outbound","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow any outbound traffic.","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_group_id":"aws_security_group.bastion.id","self":false,"to_port":0,"type":"egress"}},{"address":"aws_security_group_rule.kms_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"kms_allow_outbound","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow any outbound traffic.","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_group_id":"aws_security_group.kms_endpoint.id","self":false,"to_port":0,"type":"egress"}},{"address":"aws_security_group_rule.load_balancer_allow_443","mode":"managed","type":"aws_security_group_rule","name":"load_balancer_allow_443","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow HTTPS traffic.","from_port":443,"ipv6_cidr_blocks":["::/0"],"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.load_balancer.id","self":false,"to_port":443,"type":"ingress"}},{"address":"aws_security_group_rule.load_balancer_allow_80","mode":"managed","type":"aws_security_group_rule","name":"load_balancer_allow_80","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow HTTP traffic.","from_port":80,"ipv6_cidr_blocks":["::/0"],"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.load_balancer.id","self":false,"to_port":80,"type":"ingress"}},{"address":"aws_security_group_rule.load_balancer_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"load_balancer_allow_outbound","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow any outbound traffic.","from_port":0,"ipv6_cidr_blocks":["::/0"],"prefix_list_ids":null,"protocol":"-1","security_group_id":"aws_security_group.load_balancer.id","self":false,"to_port":0,"type":"egress"}},{"address":"aws_security_group_rule.vault_instance_allow_22_bastion","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_22_bastion","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":null,"description":"Allow SSH traffic from vault bastion.","from_port":22,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.vault_instance.id","self":false,"source_security_group_id":"aws_security_group.bastion.id","to_port":22,"type":"ingress"}},{"address":"aws_security_group_rule.vault_instance_allow_443","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_443","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":null,"description":"Allow HTTPS traffic from vault instances.","from_port":443,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.kms_endpoint.id","self":false,"source_security_group_id":"aws_security_group.vault_instance.id","to_port":443,"type":"ingress"}},{"address":"aws_security_group_rule.vault_instance_allow_80","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_80","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":null,"description":"Allow HTTP traffic from vault instances.","from_port":80,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.kms_endpoint.id","self":false,"source_security_group_id":"aws_security_group.vault_instance.id","to_port":80,"type":"ingress"}},{"address":"aws_security_group_rule.vault_instance_allow_8200","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_8200","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":null,"description":"Allow traffic from Load Balancer.","from_port":8200,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.vault_instance.id","self":false,"source_security_group_id":"aws_security_group.load_balancer.id","to_port":8200,"type":"ingress"}},{"address":"aws_security_group_rule.vault_instance_allow_8201","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_8201","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":null,"description":"Allow traffic from fellow vault instances that have this SG.","from_port":8201,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.vault_instance.id","self":true,"to_port":8201,"type":"ingress"}},{"address":"aws_security_group_rule.vault_instance_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_outbound","provider_name":"aws","schema_version":2,"values":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow any outbound traffic.","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_group_id":"aws_security_group.vault_instance.id","self":false,"to_port":0,"type":"egress"}},{"address":"aws_subnet.private[0]","mode":"managed","type":"aws_subnet","name":"private","index":0,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1a","cidr_block":"10.255.2.0/24","ipv6_cidr_block":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"Name":"vault-deployment-private-us-east-1a","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_subnet.private[1]","mode":"managed","type":"aws_subnet","name":"private","index":1,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1b","cidr_block":"10.255.3.0/24","ipv6_cidr_block":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"Name":"vault-deployment-private-us-east-1b","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_subnet.public[0]","mode":"managed","type":"aws_subnet","name":"public","index":0,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":true,"availability_zone":"us-east-1a","cidr_block":"10.255.0.0/24","map_public_ip_on_launch":true,"outpost_arn":null,"tags":{"Name":"vault-deployment-public-us-east-1a","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_subnet.public[1]","mode":"managed","type":"aws_subnet","name":"public","index":1,"provider_name":"aws","schema_version":1,"values":{"assign_ipv6_address_on_creation":true,"availability_zone":"us-east-1b","cidr_block":"10.255.1.0/24","map_public_ip_on_launch":true,"outpost_arn":null,"tags":{"Name":"vault-deployment-public-us-east-1b","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"}},{"address":"aws_vpc.vault","mode":"managed","type":"aws_vpc","name":"vault","provider_name":"aws","schema_version":1,"values":{"assign_generated_ipv6_cidr_block":true,"cidr_block":"10.255.0.0/20","enable_dns_hostnames":true,"enable_dns_support":true,"instance_tenancy":"default","tags":{"Name":"vault-deployment-vpc","Project":"vault-deployment"}}},{"address":"aws_vpc_endpoint.dynamodb","mode":"managed","type":"aws_vpc_endpoint","name":"dynamodb","provider_name":"aws","schema_version":0,"values":{"auto_accept":null,"private_dns_enabled":false,"route_table_ids":["aws_route_table.private.id"],"service_name":"com.amazonaws.us-east-1.dynamodb","tags":{"Name":"vault-deployment-dynamodb-endpoint","Project":"vault-deployment"},"timeouts":null,"vpc_endpoint_type":"Gateway","vpc_id":"aws_vpc.vault.id"}},{"address":"aws_vpc_endpoint.kms","mode":"managed","type":"aws_vpc_endpoint","name":"kms","provider_name":"aws","schema_version":0,"values":{"auto_accept":null,"private_dns_enabled":true,"security_group_ids":["aws_security_group.kms_endpoint.id"],"service_name":"com.amazonaws.us-east-1.kms","subnet_ids":["aws_subnet.private[0].id","aws_subnet.private[1].id"],"tags":{"Name":"vault-deployment-kms-endpoint","Project":"vault-deployment"},"timeouts":null,"vpc_endpoint_type":"Interface","vpc_id":"aws_vpc.vault.id"}},{"address":"data.aws_iam_policy_document.dynamodb_vault_policy","mode":"data","type":"aws_iam_policy_document","name":"dynamodb_vault_policy","provider_name":"aws","schema_version":0,"values":{"override_json":null,"policy_id":null,"source_json":null,"statement":[{"actions":["dynamodb:BatchGetItem","dynamodb:BatchWriteItem","dynamodb:DeleteItem","dynamodb:DescribeTable","dynamodb:DescribeTimeToLive","dynamodb:GetItem","dynamodb:ListTagsOfResource","dynamodb:PutItem","dynamodb:UpdateItem"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["aws_dynamodb_table.vault_storage.arn"],"sid":"ManageTable"},{"actions":["dynamodb:GetRecords"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["aws_dynamodb_table.vault_storage.arn/stream/*"],"sid":"GetStreamRecords"},{"actions":["dynamodb:Query","dynamodb:Scan"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["aws_dynamodb_table.vault_storage.arn","aws_dynamodb_table.vault_storage.arn/index/*"],"sid":"QueryAndScanTable"}],"version":null}},{"address":"data.aws_iam_policy_document.kms_vault_policy","mode":"data","type":"aws_iam_policy_document","name":"kms_vault_policy","provider_name":"aws","schema_version":0,"values":{"override_json":null,"policy_id":null,"source_json":null,"statement":[{"actions":["kms:Decrypt","kms:DescribeKey","kms:Encrypt"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["aws_kms_key.seal.arn"],"sid":"EncryptDecryptAndDescribe"}],"version":null}},{"address":"data.aws_iam_policy_document.s3_vault_policy","mode":"data","type":"aws_iam_policy_document","name":"s3_vault_policy","provider_name":"aws","schema_version":0,"values":{"override_json":null,"policy_id":null,"source_json":null,"statement":[{"actions":["s3:PutObject"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["aws_s3_bucket.vault_data.arn/*"],"sid":"PutObjects"}],"version":null}},{"address":"local_file.userdata_compiled","mode":"managed","type":"local_file","name":"userdata_compiled","provider_name":"local","schema_version":0,"values":{"content":"Content-Type: multipart/mixed; boundary=\"==BOUNDARY==\"\nMIME-Version: 1.0\n\n--==BOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -e\n\n# Run Order: 1\n# Run Frequency: only once, on first boot\n\n# Tasks:\n# - Install Dependencies\n# - Make users and directories\n# - Install download, unzip, and setup vault bin\n\n# Note: dollar-sign curly braces are template values from Terraform.\n# Non curly brace ones are normal bash variables...\n\nyum update -y\nyum install -y jq\n\n# Make the user\nuseradd --system --shell /sbin/nologin vault\n\n# Make the directories\nmkdir -p /opt/vault\nmkdir -p /opt/vault/bin\nmkdir -p /opt/vault/config\nmkdir -p /opt/vault/tls\n\n# Give corret permissions\nchmod 755 /opt/vault\nchmod 755 /opt/vault/bin\n\n# Change ownership to vault user\nchown -R vault:vault /opt/vault\n\n# Get the HashiCorp PGP\ncurl https://keybase.io/hashicorp/pgp_keys.asc | gpg --import\n\n# Download vault and signatures\ncurl -Os https://releases.hashicorp.com/vault/1.4.0/vault_1.4.0_linux_amd64.zip\ncurl -Os https://releases.hashicorp.com/vault/1.4.0/vault_1.4.0_SHA256SUMS\ncurl -Os https://releases.hashicorp.com/vault/1.4.0/vault_1.4.0_SHA256SUMS.sig\n\n# Verify Signatres\ngpg --verify vault_1.4.0_SHA256SUMS.sig vault_1.4.0_SHA256SUMS\ncat vault_1.4.0_SHA256SUMS | grep vault_1.4.0_linux_amd64.zip | sha256sum -c\n\n# unzip and move to /opt/vault/bin\nunzip vault_1.4.0_linux_amd64.zip\nmv vault /opt/vault/bin\n\n# give ownership to the vault user\nchown vault:vault /opt/vault/bin/vault\n\n# create a symlink\nln -s /opt/vault/bin/vault /usr/local/bin/vault\n\n# allow vault permissions to use mlock and prevent memory from swapping to disk\nsetcap cap_ipc_lock=+ep /opt/vault/bin/vault\n\n# cleanup files\nrm vault_1.4.0_linux_amd64.zip\nrm vault_1.4.0_SHA256SUMS\nrm vault_1.4.0_SHA256SUMS.sig\n\n--==BOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -e\n\n# Run Order: 2\n# Run Frequency: only once, on first boot\n\n# Tasks:\n# - Fetch needed data\n# - Create Self-Signed Certificate and Key\n\nINSTANCE_IP_ADDR=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\nINSTANCE_DNS_NAME=$(curl http://169.254.169.254/latest/meta-data/local-hostname)\n\n# Used for encryption between the load balancer and vault instances.\n# Th other alternatives are either creating an entire, private CA and hoping AWS\n# eventually adds the ability to add trusted CAs to load balancers...\n# ...or paying $400/month base for the ACM private CA.\nopenssl req -x509 -sha256 -nodes \\\n  -newkey rsa:4096 -days 3650 \\\n  -keyout /opt/vault/tls/vault.key -out /opt/vault/tls/vault.crt \\\n  -subj \"/CN=$INSTANCE_DNS_NAME\" \\\n  -extensions san \\\n  -config \u003c(cat /etc/pki/tls/openssl.cnf \u003c(echo -e \"\\n[san]\\nsubjectAltName=DNS:$INSTANCE_DNS_NAME,IP:$INSTANCE_IP_ADDR\"))\n\nchown vault:vault /opt/vault/tls/vault.key\nchown vault:vault /opt/vault/tls/vault.crt\n\nchmod 640 /opt/vault/tls/vault.key\nchmod 644 /opt/vault/tls/vault.crt\n\n# Trust the certificate\ncp /opt/vault/tls/vault.crt /etc/pki/tls/certs/vault.crt\n\n--==BOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -e\n\n# Run Order: 3\n# Run Frequency: only once, on first boot\n\n# Tasks:\n# - Make the vault config file\n# - Make the systemd service file\n\n# The vault config file\ncat \u003e /opt/vault/config/server.hcl \u003c\u003c- EOF\ncluster_name = \"vault-deployment\"\nmax_lease_ttl = \"192h\"\ndefault_lease_ttl = \"192h\"\nui  = \"true\"\n\n# Where can the Vault API be reached?  At DNS for the load balancer, or the CNAME created.\n# Note: this maps to the environment variable VAULT_API_ADDR not VAULT_ADDR\napi_addr = \"https://secrets.domain.com\"\n\n# For forwarding between vault servers.  Set to own ip.\ncluster_addr = \"https://INSTANCE_IP_ADDR:8201\"\n\n# Auto unseal the vault\nseal \"awskms\" {\n  region = \"us-east-1\"\n  kms_key_id = \"aws_kms_key.seal.key_id\"\n}\n\n# Listener for loopback\nlistener \"tcp\" {\n  address = \"127.0.0.1:8199\"\n  tls_disable = \"true\"\n}\n\n# Listener for private network\nlistener \"tcp\" {\n  address = \"INSTANCE_IP_ADDR:8200\"\n  cluster_address = \"INSTANCE_IP_ADDR:8201\"\n\n  tls_disable = \"false\"\n  tls_cert_file = \"/opt/vault/tls/vault.crt\"\n  tls_key_file = \"/opt/vault/tls/vault.key\"\n}\n\nstorage \"dynamodb\" {\n  ha_enabled = \"true\"\n  region = \"us-east-1\"\n  table = \"vault_storage\"\n}\nEOF\n\nchown vault:vault /opt/vault/config/server.hcl\n\n# The systemd service file\ncat \u003e /etc/systemd/system/vault.service \u003c\u003c- EOF\n[Unit]\nDescription=Vault Server on AWS\nRequires=network-online.target\nAfter=network-online.target\n\n[Service]\nUser=vault\nGroup=vault\nProtectSystem=full\nProtectHome=read-only\nPrivateTmp=yes\nPrivateDevices=yes\nSecureBits=keep-caps\nAmbientCapabilities=CAP_IPC_LOCK\nCapabilities=CAP_IPC_LOCK+ep\nCapabilityBoundingSet=CAP_SYSLOG CAP_IPC_LOCK\nNoNewPrivileges=yes\nExecStart=/opt/vault/bin/vault server -config=/opt/vault/config/ -log-level=info\nExecReload=/bin/kill --signal HUP \\$MAINPID\nKillMode=process\nKillSignal=SIGINT\nRestart=on-failure\nRestartSec=5\nTimeoutStopSec=30\nStartLimitInterval=60\nStartLimitBurst=3\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n--==BOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -e\n\n# Run Order: 4\n# Run Frequency: only once, on first boot\n\n# Tasks:\n# - Replace values in configuration files with instance metadata\n# - Start vault\n\nINSTANCE_IP_ADDR=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\nsed -i -e \"s/INSTANCE_IP_ADDR/$INSTANCE_IP_ADDR/g\" /opt/vault/config/server.hcl\n\nsystemctl daemon-reload\nsystemctl enable vault\nsystemctl restart vault\n\n--==BOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -e\n\n# Run Order: 5\n# Run Frequency: only once, on first boot\n\n# Tasks:\n# - Initialize Vault\n# - Create credentials file\n# - Encrypt the file via KMS\n# - Send the file to S3\n# - Delete the local file\n# - Erase bash history\n\n# Workaround to make sure the vault service is fully initialized.\nsleep 20\n\nexport VAULT_ADDR=\"http://127.0.0.1:8199\"\nexport AWS_DEFAULT_REGION=\"us-east-1\"\nexport VAULT_INITIALIZED=$(vault operator init -status) # avoid non-zero exit status\n\nfunction initialize_vault {\n  # initialize and pipe to file\n  vault operator init \u003e vault_credentials.txt\n\n  # encrypt it with the KMS key\n  aws kms encrypt --key-id aws_kms_key.seal.key_id --plaintext fileb://vault_credentials.txt --output text --query CiphertextBlob | base64 --decode \u003e vault_creds_encrypted\n\n  # send the encrypted file to the s3 bucket\n  aws s3 cp vault_creds_encrypted s3://aws_s3_bucket.vault_data.id/\n\n  # cleanup\n  rm vault_credentials.txt\n  rm vault_creds_encrypted\n  history -c\n  history -w\n}\n\nif [ \"$VAULT_INITIALIZED\" = \"Vault is initialized\" ]; then\n  echo \"Vault is already initialized.\"\nelse\n  echo \"Initializing vault...\"\n  initialize_vault\nfi\n\n--==BOUNDARY==--","content_base64":null,"directory_permission":"0777","file_permission":"0777","filename":"./temp/userdata_compiled.sh","sensitive_content":null,"source":null}},{"address":"local_file.vault_credentials","mode":"managed","type":"local_file","name":"vault_credentials","provider_name":"local","schema_version":0,"values":{"content":"#!/bin/bash\n\n# This grabs the encrypted credentials file and decrypts it.\n\naws --profile default --region us-east-1 s3 cp s3://aws_s3_bucket.vault_data.id/vault_creds_encrypted ./temp/vault_creds_encrypted\naws --profile default --region us-east-1 kms decrypt --key-id aws_kms_key.seal.key_id --ciphertext-blob fileb://temp/vault_creds_encrypted --output text --query Plaintext | base64 --decode \u003e ./temp/vault_creds_decrypted\n\necho \"\"\necho \"Vault crednetials decrypted.  Find them at ./temp/vault_creds_decrypted\"\necho \"----\"\necho \"Load Balancer DNS Name: aws_lb.alb.dns_name\"\necho \"\"","content_base64":null,"directory_permission":"0777","file_permission":"0777","filename":"./temp/vault_credentials.sh","sensitive_content":null,"source":null}}]}},"resource_changes":[{"address":"aws_autoscaling_group.vault-asg","mode":"managed","type":"aws_autoscaling_group","name":"vault-asg","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"capacity_rebalance":null,"desired_capacity":2,"enabled_metrics":["GroupDesiredCapacity","GroupInServiceCapacity","GroupInServiceInstances","GroupMaxSize","GroupMinSize","GroupPendingCapacity","GroupPendingInstances","GroupStandbyCapacity","GroupStandbyInstances","GroupTerminatingCapacity","GroupTerminatingInstances","GroupTotalCapacity","GroupTotalInstances"],"force_delete":false,"health_check_grace_period":300,"health_check_type":"EC2","initial_lifecycle_hook":[],"instance_refresh":[],"launch_configuration":null,"launch_template":[{"id":"aws_launch_template.vault_instance.id"}],"load_balancers":null,"max_instance_lifetime":null,"max_size":2,"metrics_granularity":"1Minute","min_elb_capacity":null,"min_size":2,"mixed_instances_policy":[],"name_prefix":"vault-deployment-asg-","placement_group":null,"protect_from_scale_in":false,"suspended_processes":null,"tag":[],"tags":[{"key":"Name","propagate_at_launch":"true","value":"vault-deployment-instance"},{"key":"Project","propagate_at_launch":"true","value":"vault-deployment"}],"target_group_arns":["aws_lb_target_group.alb_targets.arn"],"termination_policies":["OldestLaunchTemplate"],"timeouts":null,"vpc_zone_identifier":["aws_subnet.private[0].id","aws_subnet.private[1].id"],"wait_for_capacity_timeout":"0","wait_for_elb_capacity":null},"after_unknown":{"arn":true,"availability_zones":true,"default_cooldown":true,"enabled_metrics":[false,false,false,false,false,false,false,false,false,false,false,false,false],"id":true,"initial_lifecycle_hook":[],"instance_refresh":[],"launch_template":[{"name":true,"version":true}],"mixed_instances_policy":[],"name":true,"service_linked_role_arn":true,"tag":[],"tags":[{},{}],"target_group_arns":[false],"termination_policies":[false],"vpc_zone_identifier":[false,false]}}},{"address":"aws_dynamodb_table.vault_storage","mode":"managed","type":"aws_dynamodb_table","name":"vault_storage","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"attribute":[{"name":"Key","type":"S"},{"name":"Path","type":"S"}],"billing_mode":"PAY_PER_REQUEST","global_secondary_index":[],"hash_key":"Path","local_secondary_index":[],"name":"vault_storage","range_key":"Key","read_capacity":null,"replica":[],"stream_enabled":null,"tags":{"Name":"vault_storage","Project":"vault-deployment"},"timeouts":null,"ttl":[],"write_capacity":null},"after_unknown":{"arn":true,"attribute":[{},{}],"global_secondary_index":[],"id":true,"local_secondary_index":[],"point_in_time_recovery":true,"replica":[],"server_side_encryption":true,"stream_arn":true,"stream_label":true,"stream_view_type":true,"tags":{},"ttl":[]}}},{"address":"aws_egress_only_internet_gateway.eigw","mode":"managed","type":"aws_egress_only_internet_gateway","name":"eigw","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":null,"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"id":true}}},{"address":"aws_eip.nat[0]","mode":"managed","type":"aws_eip","name":"nat","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"associate_with_private_ip":null,"customer_owned_ipv4_pool":null,"tags":{"Name":"vault-deployment-nat-eip","Project":"vault-deployment"},"timeouts":null,"vpc":true},"after_unknown":{"allocation_id":true,"association_id":true,"carrier_ip":true,"customer_owned_ip":true,"domain":true,"id":true,"instance":true,"network_border_group":true,"network_interface":true,"private_dns":true,"private_ip":true,"public_dns":true,"public_ip":true,"public_ipv4_pool":true,"tags":{}}}},{"address":"aws_iam_instance_profile.vault_instance_profile","mode":"managed","type":"aws_iam_instance_profile","name":"vault_instance_profile","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"name_prefix":"vault-deployment-instance-profile-","path":"/","role":"aws_iam_role.vault_instance.name"},"after_unknown":{"arn":true,"create_date":true,"id":true,"name":true,"unique_id":true}}},{"address":"aws_iam_role.vault_instance","mode":"managed","type":"aws_iam_role","name":"vault_instance","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assume_role_policy":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      }\n    }\n  ]\n}","description":null,"force_detach_policies":false,"max_session_duration":3600,"name_prefix":"vault-deployment-instance-role-","path":"/","permissions_boundary":null,"tags":null},"after_unknown":{"arn":true,"create_date":true,"id":true,"name":true,"unique_id":true}}},{"address":"aws_iam_role_policy.vault_instance_dynamodb_policy","mode":"managed","type":"aws_iam_role_policy","name":"vault_instance_dynamodb_policy","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"name_prefix":"vault-deployment-instance-dynamodb-policy-","policy":"data.aws_iam_policy_document.dynamodb_vault_policy.json","role":"aws_iam_role.vault_instance.id"},"after_unknown":{"id":true,"name":true}}},{"address":"aws_iam_role_policy.vault_instance_kms_policy","mode":"managed","type":"aws_iam_role_policy","name":"vault_instance_kms_policy","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"name_prefix":"vault-deployment-instance-kms-policy-","policy":"data.aws_iam_policy_document.kms_vault_policy.json","role":"aws_iam_role.vault_instance.id"},"after_unknown":{"id":true,"name":true}}},{"address":"aws_iam_role_policy.vault_instance_s3_policy","mode":"managed","type":"aws_iam_role_policy","name":"vault_instance_s3_policy","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"name_prefix":"vault-deployment-instance-s3-policy-","policy":"data.aws_iam_policy_document.s3_vault_policy.json","role":"aws_iam_role.vault_instance.id"},"after_unknown":{"id":true,"name":true}}},{"address":"aws_instance.bastion[0]","mode":"managed","type":"aws_instance","name":"bastion","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"ami":"ami-0323c3dd2da7fb37d","associate_public_ip_address":true,"credit_specification":[],"disable_api_termination":null,"ebs_optimized":null,"get_password_data":false,"hibernation":null,"iam_instance_profile":null,"instance_initiated_shutdown_behavior":null,"instance_type":"t2.micro","key_name":"vault_key_pair","monitoring":null,"source_dest_check":true,"subnet_id":"aws_subnet.public[0].id","tags":{"Name":"vault-deployment-bastion","Project":"vault-deployment"},"timeouts":null,"user_data":null,"user_data_base64":null,"volume_tags":null,"vpc_security_group_ids":["aws_security_group.bastion.id"]},"after_unknown":{"arn":true,"availability_zone":true,"cpu_core_count":true,"cpu_threads_per_core":true,"credit_specification":[],"ebs_block_device":true,"enclave_options":true,"ephemeral_block_device":true,"host_id":true,"id":true,"instance_state":true,"ipv6_address_count":true,"ipv6_addresses":true,"metadata_options":true,"network_interface":true,"outpost_arn":true,"password_data":true,"placement_group":true,"primary_network_interface_id":true,"private_dns":true,"private_ip":true,"public_dns":true,"public_ip":true,"root_block_device":true,"secondary_private_ips":true,"security_groups":true,"tags":{},"tenancy":true,"vpc_security_group_ids":[false]}}},{"address":"aws_internet_gateway.igw","mode":"managed","type":"aws_internet_gateway","name":"igw","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"vault-deployment-igw","Project":"vault-deployment"},"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"id":true,"owner_id":true,"tags":{}}}},{"address":"aws_kms_alias.seal","mode":"managed","type":"aws_kms_alias","name":"seal","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"name":"alias/vault-deployment-seal-key","name_prefix":null,"target_key_id":"aws_kms_key.seal.key_id"},"after_unknown":{"arn":true,"id":true,"target_key_arn":true}}},{"address":"aws_kms_key.seal","mode":"managed","type":"aws_kms_key","name":"seal","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"customer_master_key_spec":"SYMMETRIC_DEFAULT","deletion_window_in_days":null,"description":"The KMS key to unseal Vault.","enable_key_rotation":true,"is_enabled":true,"key_usage":"ENCRYPT_DECRYPT","tags":{"Name":"vault-deployment-seal-key","Project":"vault-deployment"}},"after_unknown":{"arn":true,"id":true,"key_id":true,"policy":true,"tags":{}}}},{"address":"aws_launch_template.vault_instance","mode":"managed","type":"aws_launch_template","name":"vault_instance","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"block_device_mappings":[],"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"description":null,"disable_api_termination":null,"ebs_optimized":null,"elastic_gpu_specifications":[],"elastic_inference_accelerator":[],"enclave_options":[],"hibernation_options":[],"iam_instance_profile":[{"arn":"aws_iam_instance_profile.vault_instance_profile.arn","name":null}],"image_id":"ami-0323c3dd2da7fb37d","instance_initiated_shutdown_behavior":null,"instance_market_options":[],"instance_type":"t2.medium","kernel_id":null,"key_name":"vault_key_pair","license_specification":[],"monitoring":[],"name_prefix":"vault-deployment-lt-","network_interfaces":[],"placement":[],"ram_disk_id":null,"security_group_names":null,"tag_specifications":[{"resource_type":"instance","tags":{"Name":"vault-deployment-instance","Project":"vault-deployment"}},{"resource_type":"volume","tags":{"Name":"vault-deployment-volume","Project":"vault-deployment"}}],"tags":{"Name":"vault-deployment-lt","Project":"vault-deployment"},"update_default_version":null,"user_data":"Q29udGVudC1UeXBlOiBtdWx0aXBhcnQvbWl4ZWQ7IGJvdW5kYXJ5PSI9PUJPVU5EQVJZPT0iCk1JTUUtVmVyc2lvbjogMS4wCgotLT09Qk9VTkRBUlk9PQpDb250ZW50LVR5cGU6IHRleHQveC1zaGVsbHNjcmlwdDsgY2hhcnNldD0idXMtYXNjaWkiCgojIS9iaW4vYmFzaApzZXQgLWUKCiMgUnVuIE9yZGVyOiAxCiMgUnVuIEZyZXF1ZW5jeTogb25seSBvbmNlLCBvbiBmaXJzdCBib290CgojIFRhc2tzOgojIC0gSW5zdGFsbCBEZXBlbmRlbmNpZXMKIyAtIE1ha2UgdXNlcnMgYW5kIGRpcmVjdG9yaWVzCiMgLSBJbnN0YWxsIGRvd25sb2FkLCB1bnppcCwgYW5kIHNldHVwIHZhdWx0IGJpbgoKIyBOb3RlOiBkb2xsYXItc2lnbiBjdXJseSBicmFjZXMgYXJlIHRlbXBsYXRlIHZhbHVlcyBmcm9tIFRlcnJhZm9ybS4KIyBOb24gY3VybHkgYnJhY2Ugb25lcyBhcmUgbm9ybWFsIGJhc2ggdmFyaWFibGVzLi4uCgp5dW0gdXBkYXRlIC15Cnl1bSBpbnN0YWxsIC15IGpxCgojIE1ha2UgdGhlIHVzZXIKdXNlcmFkZCAtLXN5c3RlbSAtLXNoZWxsIC9zYmluL25vbG9naW4gdmF1bHQKCiMgTWFrZSB0aGUgZGlyZWN0b3JpZXMKbWtkaXIgLXAgL29wdC92YXVsdApta2RpciAtcCAvb3B0L3ZhdWx0L2Jpbgpta2RpciAtcCAvb3B0L3ZhdWx0L2NvbmZpZwpta2RpciAtcCAvb3B0L3ZhdWx0L3RscwoKIyBHaXZlIGNvcnJldCBwZXJtaXNzaW9ucwpjaG1vZCA3NTUgL29wdC92YXVsdApjaG1vZCA3NTUgL29wdC92YXVsdC9iaW4KCiMgQ2hhbmdlIG93bmVyc2hpcCB0byB2YXVsdCB1c2VyCmNob3duIC1SIHZhdWx0OnZhdWx0IC9vcHQvdmF1bHQKCiMgR2V0IHRoZSBIYXNoaUNvcnAgUEdQCmN1cmwgaHR0cHM6Ly9rZXliYXNlLmlvL2hhc2hpY29ycC9wZ3Bfa2V5cy5hc2MgfCBncGcgLS1pbXBvcnQKCiMgRG93bmxvYWQgdmF1bHQgYW5kIHNpZ25hdHVyZXMKY3VybCAtT3MgaHR0cHM6Ly9yZWxlYXNlcy5oYXNoaWNvcnAuY29tL3ZhdWx0LzEuNC4wL3ZhdWx0XzEuNC4wX2xpbnV4X2FtZDY0LnppcApjdXJsIC1PcyBodHRwczovL3JlbGVhc2VzLmhhc2hpY29ycC5jb20vdmF1bHQvMS40LjAvdmF1bHRfMS40LjBfU0hBMjU2U1VNUwpjdXJsIC1PcyBodHRwczovL3JlbGVhc2VzLmhhc2hpY29ycC5jb20vdmF1bHQvMS40LjAvdmF1bHRfMS40LjBfU0hBMjU2U1VNUy5zaWcKCiMgVmVyaWZ5IFNpZ25hdHJlcwpncGcgLS12ZXJpZnkgdmF1bHRfMS40LjBfU0hBMjU2U1VNUy5zaWcgdmF1bHRfMS40LjBfU0hBMjU2U1VNUwpjYXQgdmF1bHRfMS40LjBfU0hBMjU2U1VNUyB8IGdyZXAgdmF1bHRfMS40LjBfbGludXhfYW1kNjQuemlwIHwgc2hhMjU2c3VtIC1jCgojIHVuemlwIGFuZCBtb3ZlIHRvIC9vcHQvdmF1bHQvYmluCnVuemlwIHZhdWx0XzEuNC4wX2xpbnV4X2FtZDY0LnppcAptdiB2YXVsdCAvb3B0L3ZhdWx0L2JpbgoKIyBnaXZlIG93bmVyc2hpcCB0byB0aGUgdmF1bHQgdXNlcgpjaG93biB2YXVsdDp2YXVsdCAvb3B0L3ZhdWx0L2Jpbi92YXVsdAoKIyBjcmVhdGUgYSBzeW1saW5rCmxuIC1zIC9vcHQvdmF1bHQvYmluL3ZhdWx0IC91c3IvbG9jYWwvYmluL3ZhdWx0CgojIGFsbG93IHZhdWx0IHBlcm1pc3Npb25zIHRvIHVzZSBtbG9jayBhbmQgcHJldmVudCBtZW1vcnkgZnJvbSBzd2FwcGluZyB0byBkaXNrCnNldGNhcCBjYXBfaXBjX2xvY2s9K2VwIC9vcHQvdmF1bHQvYmluL3ZhdWx0CgojIGNsZWFudXAgZmlsZXMKcm0gdmF1bHRfMS40LjBfbGludXhfYW1kNjQuemlwCnJtIHZhdWx0XzEuNC4wX1NIQTI1NlNVTVMKcm0gdmF1bHRfMS40LjBfU0hBMjU2U1VNUy5zaWcKCi0tPT1CT1VOREFSWT09CkNvbnRlbnQtVHlwZTogdGV4dC94LXNoZWxsc2NyaXB0OyBjaGFyc2V0PSJ1cy1hc2NpaSIKCiMhL2Jpbi9iYXNoCnNldCAtZQoKIyBSdW4gT3JkZXI6IDIKIyBSdW4gRnJlcXVlbmN5OiBvbmx5IG9uY2UsIG9uIGZpcnN0IGJvb3QKCiMgVGFza3M6CiMgLSBGZXRjaCBuZWVkZWQgZGF0YQojIC0gQ3JlYXRlIFNlbGYtU2lnbmVkIENlcnRpZmljYXRlIGFuZCBLZXkKCklOU1RBTkNFX0lQX0FERFI9JChjdXJsIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9sb2NhbC1pcHY0KQpJTlNUQU5DRV9ETlNfTkFNRT0kKGN1cmwgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWhvc3RuYW1lKQoKIyBVc2VkIGZvciBlbmNyeXB0aW9uIGJldHdlZW4gdGhlIGxvYWQgYmFsYW5jZXIgYW5kIHZhdWx0IGluc3RhbmNlcy4KIyBUaCBvdGhlciBhbHRlcm5hdGl2ZXMgYXJlIGVpdGhlciBjcmVhdGluZyBhbiBlbnRpcmUsIHByaXZhdGUgQ0EgYW5kIGhvcGluZyBBV1MKIyBldmVudHVhbGx5IGFkZHMgdGhlIGFiaWxpdHkgdG8gYWRkIHRydXN0ZWQgQ0FzIHRvIGxvYWQgYmFsYW5jZXJzLi4uCiMgLi4ub3IgcGF5aW5nICQ0MDAvbW9udGggYmFzZSBmb3IgdGhlIEFDTSBwcml2YXRlIENBLgpvcGVuc3NsIHJlcSAteDUwOSAtc2hhMjU2IC1ub2RlcyBcCiAgLW5ld2tleSByc2E6NDA5NiAtZGF5cyAzNjUwIFwKICAta2V5b3V0IC9vcHQvdmF1bHQvdGxzL3ZhdWx0LmtleSAtb3V0IC9vcHQvdmF1bHQvdGxzL3ZhdWx0LmNydCBcCiAgLXN1YmogIi9DTj0kSU5TVEFOQ0VfRE5TX05BTUUiIFwKICAtZXh0ZW5zaW9ucyBzYW4gXAogIC1jb25maWcgPChjYXQgL2V0Yy9wa2kvdGxzL29wZW5zc2wuY25mIDwoZWNobyAtZSAiXG5bc2FuXVxuc3ViamVjdEFsdE5hbWU9RE5TOiRJTlNUQU5DRV9ETlNfTkFNRSxJUDokSU5TVEFOQ0VfSVBfQUREUiIpKQoKY2hvd24gdmF1bHQ6dmF1bHQgL29wdC92YXVsdC90bHMvdmF1bHQua2V5CmNob3duIHZhdWx0OnZhdWx0IC9vcHQvdmF1bHQvdGxzL3ZhdWx0LmNydAoKY2htb2QgNjQwIC9vcHQvdmF1bHQvdGxzL3ZhdWx0LmtleQpjaG1vZCA2NDQgL29wdC92YXVsdC90bHMvdmF1bHQuY3J0CgojIFRydXN0IHRoZSBjZXJ0aWZpY2F0ZQpjcCAvb3B0L3ZhdWx0L3Rscy92YXVsdC5jcnQgL2V0Yy9wa2kvdGxzL2NlcnRzL3ZhdWx0LmNydAoKLS09PUJPVU5EQVJZPT0KQ29udGVudC1UeXBlOiB0ZXh0L3gtc2hlbGxzY3JpcHQ7IGNoYXJzZXQ9InVzLWFzY2lpIgoKIyEvYmluL2Jhc2gKc2V0IC1lCgojIFJ1biBPcmRlcjogMwojIFJ1biBGcmVxdWVuY3k6IG9ubHkgb25jZSwgb24gZmlyc3QgYm9vdAoKIyBUYXNrczoKIyAtIE1ha2UgdGhlIHZhdWx0IGNvbmZpZyBmaWxlCiMgLSBNYWtlIHRoZSBzeXN0ZW1kIHNlcnZpY2UgZmlsZQoKIyBUaGUgdmF1bHQgY29uZmlnIGZpbGUKY2F0ID4gL29wdC92YXVsdC9jb25maWcvc2VydmVyLmhjbCA8PC0gRU9GCmNsdXN0ZXJfbmFtZSA9ICJ2YXVsdC1kZXBsb3ltZW50IgptYXhfbGVhc2VfdHRsID0gIjE5MmgiCmRlZmF1bHRfbGVhc2VfdHRsID0gIjE5MmgiCnVpICA9ICJ0cnVlIgoKIyBXaGVyZSBjYW4gdGhlIFZhdWx0IEFQSSBiZSByZWFjaGVkPyAgQXQgRE5TIGZvciB0aGUgbG9hZCBiYWxhbmNlciwgb3IgdGhlIENOQU1FIGNyZWF0ZWQuCiMgTm90ZTogdGhpcyBtYXBzIHRvIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZSBWQVVMVF9BUElfQUREUiBub3QgVkFVTFRfQUREUgphcGlfYWRkciA9ICJodHRwczovL3NlY3JldHMuZG9tYWluLmNvbSIKCiMgRm9yIGZvcndhcmRpbmcgYmV0d2VlbiB2YXVsdCBzZXJ2ZXJzLiAgU2V0IHRvIG93biBpcC4KY2x1c3Rlcl9hZGRyID0gImh0dHBzOi8vSU5TVEFOQ0VfSVBfQUREUjo4MjAxIgoKIyBBdXRvIHVuc2VhbCB0aGUgdmF1bHQKc2VhbCAiYXdza21zIiB7CiAgcmVnaW9uID0gInVzLWVhc3QtMSIKICBrbXNfa2V5X2lkID0gImF3c19rbXNfa2V5LnNlYWwua2V5X2lkIgp9CgojIExpc3RlbmVyIGZvciBsb29wYmFjawpsaXN0ZW5lciAidGNwIiB7CiAgYWRkcmVzcyA9ICIxMjcuMC4wLjE6ODE5OSIKICB0bHNfZGlzYWJsZSA9ICJ0cnVlIgp9CgojIExpc3RlbmVyIGZvciBwcml2YXRlIG5ldHdvcmsKbGlzdGVuZXIgInRjcCIgewogIGFkZHJlc3MgPSAiSU5TVEFOQ0VfSVBfQUREUjo4MjAwIgogIGNsdXN0ZXJfYWRkcmVzcyA9ICJJTlNUQU5DRV9JUF9BRERSOjgyMDEiCgogIHRsc19kaXNhYmxlID0gImZhbHNlIgogIHRsc19jZXJ0X2ZpbGUgPSAiL29wdC92YXVsdC90bHMvdmF1bHQuY3J0IgogIHRsc19rZXlfZmlsZSA9ICIvb3B0L3ZhdWx0L3Rscy92YXVsdC5rZXkiCn0KCnN0b3JhZ2UgImR5bmFtb2RiIiB7CiAgaGFfZW5hYmxlZCA9ICJ0cnVlIgogIHJlZ2lvbiA9ICJ1cy1lYXN0LTEiCiAgdGFibGUgPSAidmF1bHRfc3RvcmFnZSIKfQpFT0YKCmNob3duIHZhdWx0OnZhdWx0IC9vcHQvdmF1bHQvY29uZmlnL3NlcnZlci5oY2wKCiMgVGhlIHN5c3RlbWQgc2VydmljZSBmaWxlCmNhdCA+IC9ldGMvc3lzdGVtZC9zeXN0ZW0vdmF1bHQuc2VydmljZSA8PC0gRU9GCltVbml0XQpEZXNjcmlwdGlvbj1WYXVsdCBTZXJ2ZXIgb24gQVdTClJlcXVpcmVzPW5ldHdvcmstb25saW5lLnRhcmdldApBZnRlcj1uZXR3b3JrLW9ubGluZS50YXJnZXQKCltTZXJ2aWNlXQpVc2VyPXZhdWx0Ckdyb3VwPXZhdWx0ClByb3RlY3RTeXN0ZW09ZnVsbApQcm90ZWN0SG9tZT1yZWFkLW9ubHkKUHJpdmF0ZVRtcD15ZXMKUHJpdmF0ZURldmljZXM9eWVzClNlY3VyZUJpdHM9a2VlcC1jYXBzCkFtYmllbnRDYXBhYmlsaXRpZXM9Q0FQX0lQQ19MT0NLCkNhcGFiaWxpdGllcz1DQVBfSVBDX0xPQ0srZXAKQ2FwYWJpbGl0eUJvdW5kaW5nU2V0PUNBUF9TWVNMT0cgQ0FQX0lQQ19MT0NLCk5vTmV3UHJpdmlsZWdlcz15ZXMKRXhlY1N0YXJ0PS9vcHQvdmF1bHQvYmluL3ZhdWx0IHNlcnZlciAtY29uZmlnPS9vcHQvdmF1bHQvY29uZmlnLyAtbG9nLWxldmVsPWluZm8KRXhlY1JlbG9hZD0vYmluL2tpbGwgLS1zaWduYWwgSFVQIFwkTUFJTlBJRApLaWxsTW9kZT1wcm9jZXNzCktpbGxTaWduYWw9U0lHSU5UClJlc3RhcnQ9b24tZmFpbHVyZQpSZXN0YXJ0U2VjPTUKVGltZW91dFN0b3BTZWM9MzAKU3RhcnRMaW1pdEludGVydmFsPTYwClN0YXJ0TGltaXRCdXJzdD0zCkxpbWl0Tk9GSUxFPTY1NTM2CgpbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQKRU9GCgotLT09Qk9VTkRBUlk9PQpDb250ZW50LVR5cGU6IHRleHQveC1zaGVsbHNjcmlwdDsgY2hhcnNldD0idXMtYXNjaWkiCgojIS9iaW4vYmFzaApzZXQgLWUKCiMgUnVuIE9yZGVyOiA0CiMgUnVuIEZyZXF1ZW5jeTogb25seSBvbmNlLCBvbiBmaXJzdCBib290CgojIFRhc2tzOgojIC0gUmVwbGFjZSB2YWx1ZXMgaW4gY29uZmlndXJhdGlvbiBmaWxlcyB3aXRoIGluc3RhbmNlIG1ldGFkYXRhCiMgLSBTdGFydCB2YXVsdAoKSU5TVEFOQ0VfSVBfQUREUj0kKGN1cmwgaHR0cDovLzE2OS4yNTQuMTY5LjI1NC9sYXRlc3QvbWV0YS1kYXRhL2xvY2FsLWlwdjQpCnNlZCAtaSAtZSAicy9JTlNUQU5DRV9JUF9BRERSLyRJTlNUQU5DRV9JUF9BRERSL2ciIC9vcHQvdmF1bHQvY29uZmlnL3NlcnZlci5oY2wKCnN5c3RlbWN0bCBkYWVtb24tcmVsb2FkCnN5c3RlbWN0bCBlbmFibGUgdmF1bHQKc3lzdGVtY3RsIHJlc3RhcnQgdmF1bHQKCi0tPT1CT1VOREFSWT09CkNvbnRlbnQtVHlwZTogdGV4dC94LXNoZWxsc2NyaXB0OyBjaGFyc2V0PSJ1cy1hc2NpaSIKCiMhL2Jpbi9iYXNoCnNldCAtZQoKIyBSdW4gT3JkZXI6IDUKIyBSdW4gRnJlcXVlbmN5OiBvbmx5IG9uY2UsIG9uIGZpcnN0IGJvb3QKCiMgVGFza3M6CiMgLSBJbml0aWFsaXplIFZhdWx0CiMgLSBDcmVhdGUgY3JlZGVudGlhbHMgZmlsZQojIC0gRW5jcnlwdCB0aGUgZmlsZSB2aWEgS01TCiMgLSBTZW5kIHRoZSBmaWxlIHRvIFMzCiMgLSBEZWxldGUgdGhlIGxvY2FsIGZpbGUKIyAtIEVyYXNlIGJhc2ggaGlzdG9yeQoKIyBXb3JrYXJvdW5kIHRvIG1ha2Ugc3VyZSB0aGUgdmF1bHQgc2VydmljZSBpcyBmdWxseSBpbml0aWFsaXplZC4Kc2xlZXAgMjAKCmV4cG9ydCBWQVVMVF9BRERSPSJodHRwOi8vMTI3LjAuMC4xOjgxOTkiCmV4cG9ydCBBV1NfREVGQVVMVF9SRUdJT049InVzLWVhc3QtMSIKZXhwb3J0IFZBVUxUX0lOSVRJQUxJWkVEPSQodmF1bHQgb3BlcmF0b3IgaW5pdCAtc3RhdHVzKSAjIGF2b2lkIG5vbi16ZXJvIGV4aXQgc3RhdHVzCgpmdW5jdGlvbiBpbml0aWFsaXplX3ZhdWx0IHsKICAjIGluaXRpYWxpemUgYW5kIHBpcGUgdG8gZmlsZQogIHZhdWx0IG9wZXJhdG9yIGluaXQgPiB2YXVsdF9jcmVkZW50aWFscy50eHQKCiAgIyBlbmNyeXB0IGl0IHdpdGggdGhlIEtNUyBrZXkKICBhd3Mga21zIGVuY3J5cHQgLS1rZXktaWQgYXdzX2ttc19rZXkuc2VhbC5rZXlfaWQgLS1wbGFpbnRleHQgZmlsZWI6Ly92YXVsdF9jcmVkZW50aWFscy50eHQgLS1vdXRwdXQgdGV4dCAtLXF1ZXJ5IENpcGhlcnRleHRCbG9iIHwgYmFzZTY0IC0tZGVjb2RlID4gdmF1bHRfY3JlZHNfZW5jcnlwdGVkCgogICMgc2VuZCB0aGUgZW5jcnlwdGVkIGZpbGUgdG8gdGhlIHMzIGJ1Y2tldAogIGF3cyBzMyBjcCB2YXVsdF9jcmVkc19lbmNyeXB0ZWQgczM6Ly9hd3NfczNfYnVja2V0LnZhdWx0X2RhdGEuaWQvCgogICMgY2xlYW51cAogIHJtIHZhdWx0X2NyZWRlbnRpYWxzLnR4dAogIHJtIHZhdWx0X2NyZWRzX2VuY3J5cHRlZAogIGhpc3RvcnkgLWMKICBoaXN0b3J5IC13Cn0KCmlmIFsgIiRWQVVMVF9JTklUSUFMSVpFRCIgPSAiVmF1bHQgaXMgaW5pdGlhbGl6ZWQiIF07IHRoZW4KICBlY2hvICJWYXVsdCBpcyBhbHJlYWR5IGluaXRpYWxpemVkLiIKZWxzZQogIGVjaG8gIkluaXRpYWxpemluZyB2YXVsdC4uLiIKICBpbml0aWFsaXplX3ZhdWx0CmZpCgotLT09Qk9VTkRBUlk9PS0t","vpc_security_group_ids":["aws_security_group.vault_instance.id"]},"after_unknown":{"arn":true,"block_device_mappings":[],"capacity_reservation_specification":[],"cpu_options":[],"credit_specification":[],"default_version":true,"elastic_gpu_specifications":[],"elastic_inference_accelerator":[],"enclave_options":[],"hibernation_options":[],"iam_instance_profile":[{}],"id":true,"instance_market_options":[],"latest_version":true,"license_specification":[],"metadata_options":true,"monitoring":[],"name":true,"network_interfaces":[],"placement":[],"tag_specifications":[{"tags":{}},{"tags":{}}],"tags":{},"vpc_security_group_ids":[false]}}},{"address":"aws_lb.alb","mode":"managed","type":"aws_lb","name":"alb","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"access_logs":[],"customer_owned_ipv4_pool":null,"drop_invalid_header_fields":false,"enable_cross_zone_load_balancing":null,"enable_deletion_protection":false,"enable_http2":true,"idle_timeout":60,"internal":false,"ip_address_type":"dualstack","load_balancer_type":"application","name_prefix":"vault-","security_groups":["aws_security_group.load_balancer.id"],"subnets":["aws_subnet.public[0].id","aws_subnet.public[1].id"],"tags":{"Name":"vault-deployment-alb","Project":"vault-deployment"},"timeouts":null},"after_unknown":{"access_logs":[],"arn":true,"arn_suffix":true,"dns_name":true,"id":true,"name":true,"security_groups":[false],"subnet_mapping":true,"subnets":[false,false],"tags":{},"vpc_id":true,"zone_id":true}}},{"address":"aws_lb_listener.alb_http_redirect","mode":"managed","type":"aws_lb_listener","name":"alb_http_redirect","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"certificate_arn":null,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"redirect":[{"host":"#{host}","path":"/#{path}","port":"443","protocol":"HTTPS","query":"#{query}","status_code":"HTTP_301"}],"target_group_arn":null,"type":"redirect"}],"load_balancer_arn":"aws_lb.alb.arn","port":80,"protocol":"HTTP","timeouts":null},"after_unknown":{"arn":true,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"order":true,"redirect":[{}]}],"id":true,"ssl_policy":true}}},{"address":"aws_lb_listener.alb_https","mode":"managed","type":"aws_lb_listener","name":"alb_https","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"certificate_arn":null,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"redirect":[],"target_group_arn":"aws_lb_target_group.alb_targets.arn","type":"forward"}],"load_balancer_arn":"aws_lb.alb.arn","port":443,"protocol":"HTTPS","ssl_policy":"ELBSecurityPolicy-FS-2018-06","timeouts":null},"after_unknown":{"arn":true,"default_action":[{"authenticate_cognito":[],"authenticate_oidc":[],"fixed_response":[],"forward":[],"order":true,"redirect":[]}],"id":true}}},{"address":"aws_lb_target_group.alb_targets","mode":"managed","type":"aws_lb_target_group","name":"alb_targets","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"deregistration_delay":30,"health_check":[{"enabled":true,"healthy_threshold":3,"interval":10,"matcher":"200","path":"/v1/sys/health","port":"traffic-port","protocol":"HTTPS","timeout":5,"unhealthy_threshold":3}],"lambda_multi_value_headers_enabled":false,"name_prefix":"vault-","port":8200,"protocol":"HTTPS","proxy_protocol_v2":false,"slow_start":0,"tags":{"Name":"vault-deployment-tg","Project":"vault-deployment"},"target_type":"instance","vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"arn_suffix":true,"health_check":[{}],"id":true,"load_balancing_algorithm_type":true,"name":true,"stickiness":true,"tags":{}}}},{"address":"aws_nat_gateway.nat[0]","mode":"managed","type":"aws_nat_gateway","name":"nat","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"allocation_id":"aws_eip.nat[0].id","subnet_id":"aws_subnet.public[0].id","tags":{"Name":"vault-deployment-nat","Project":"vault-deployment"}},"after_unknown":{"id":true,"network_interface_id":true,"private_ip":true,"public_ip":true,"tags":{}}}},{"address":"aws_route.private_internet_access[0]","mode":"managed","type":"aws_route","name":"private_internet_access","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"nat_gateway_id":"aws_nat_gateway.nat[0].id","route_table_id":"aws_route_table.private.id","timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"egress_only_gateway_id":true,"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"local_gateway_id":true,"network_interface_id":true,"origin":true,"state":true}}},{"address":"aws_route.private_internet_access_ipv6[0]","mode":"managed","type":"aws_route","name":"private_internet_access_ipv6","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":null,"destination_ipv6_cidr_block":"::/0","egress_only_gateway_id":"aws_egress_only_internet_gateway.eigw.id","route_table_id":"aws_route_table.private.id","timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"local_gateway_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"state":true}}},{"address":"aws_route.public_internet_access","mode":"managed","type":"aws_route","name":"public_internet_access","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"destination_cidr_block":"0.0.0.0/0","destination_ipv6_cidr_block":null,"gateway_id":"aws_internet_gateway.igw.id","route_table_id":"aws_route_table.public.id","timeouts":null,"transit_gateway_id":null,"vpc_endpoint_id":null,"vpc_peering_connection_id":null},"after_unknown":{"destination_prefix_list_id":true,"egress_only_gateway_id":true,"id":true,"instance_id":true,"instance_owner_id":true,"local_gateway_id":true,"nat_gateway_id":true,"network_interface_id":true,"origin":true,"state":true}}},{"address":"aws_route_table.private","mode":"managed","type":"aws_route_table","name":"private","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"vault-deployment-private-rtb","Project":"vault-deployment"},"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{}}}},{"address":"aws_route_table.public","mode":"managed","type":"aws_route_table","name":"public","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"tags":{"Name":"vault-deployment-public-rtb","Project":"vault-deployment"},"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"id":true,"owner_id":true,"propagating_vgws":true,"route":true,"tags":{}}}},{"address":"aws_route_table_association.private[0]","mode":"managed","type":"aws_route_table_association","name":"private","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"route_table_id":"aws_route_table.private.id","subnet_id":"aws_subnet.private[0].id"},"after_unknown":{"id":true}}},{"address":"aws_route_table_association.private[1]","mode":"managed","type":"aws_route_table_association","name":"private","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"route_table_id":"aws_route_table.private.id","subnet_id":"aws_subnet.private[1].id"},"after_unknown":{"id":true}}},{"address":"aws_route_table_association.public[0]","mode":"managed","type":"aws_route_table_association","name":"public","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"route_table_id":"aws_route_table.public.id","subnet_id":"aws_subnet.public[0].id"},"after_unknown":{"id":true}}},{"address":"aws_route_table_association.public[1]","mode":"managed","type":"aws_route_table_association","name":"public","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"gateway_id":null,"route_table_id":"aws_route_table.public.id","subnet_id":"aws_subnet.public[1].id"},"after_unknown":{"id":true}}},{"address":"aws_s3_bucket.vault_data","mode":"managed","type":"aws_s3_bucket","name":"vault_data","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"acl":"private","bucket_prefix":"vault-deployment-","cors_rule":[],"force_destroy":false,"grant":[],"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"policy":null,"replication_configuration":[],"server_side_encryption_configuration":[{"rule":[{"apply_server_side_encryption_by_default":[{"kms_master_key_id":null,"sse_algorithm":"AES256"}]}]}],"tags":{"Project":"vault-deployment"},"website":[]},"after_unknown":{"acceleration_status":true,"arn":true,"bucket":true,"bucket_domain_name":true,"bucket_regional_domain_name":true,"cors_rule":[],"grant":[],"hosted_zone_id":true,"id":true,"lifecycle_rule":[],"logging":[],"object_lock_configuration":[],"region":true,"replication_configuration":[],"request_payer":true,"server_side_encryption_configuration":[{"rule":[{"apply_server_side_encryption_by_default":[{}]}]}],"tags":{},"versioning":true,"website":[],"website_domain":true,"website_endpoint":true}}},{"address":"aws_s3_bucket_public_access_block.vault_data","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"vault_data","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"block_public_acls":true,"block_public_policy":true,"bucket":"aws_s3_bucket.vault_data.id","ignore_public_acls":true,"restrict_public_buckets":true},"after_unknown":{"id":true}}},{"address":"aws_security_group.bastion","mode":"managed","type":"aws_security_group","name":"bastion","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"description":"Firewall for the operator bastion instance","name_prefix":"vault-deployment-bastion-sg","revoke_rules_on_delete":false,"tags":{"Name":"vault-deployment-bastion-sg","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"egress":true,"id":true,"ingress":true,"name":true,"owner_id":true,"tags":{}}}},{"address":"aws_security_group.kms_endpoint","mode":"managed","type":"aws_security_group","name":"kms_endpoint","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"description":"Firewall for the KMS Endpoint.","name_prefix":"vault-deployment-kms-endpoint-sg","revoke_rules_on_delete":false,"tags":{"Name":"vault-deployment-kms-endpoint-sg","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"egress":true,"id":true,"ingress":true,"name":true,"owner_id":true,"tags":{}}}},{"address":"aws_security_group.load_balancer","mode":"managed","type":"aws_security_group","name":"load_balancer","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"description":"Firewall for the application load balancer fronting the vault instances.","name_prefix":"vault-deployment-alb-sg","revoke_rules_on_delete":false,"tags":{"Name":"vault-deployment-alb-sg","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"egress":true,"id":true,"ingress":true,"name":true,"owner_id":true,"tags":{}}}},{"address":"aws_security_group.vault_instance","mode":"managed","type":"aws_security_group","name":"vault_instance","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"description":"Firewall for the vault instances.","name_prefix":"vault-deployment-vault-instance-sg","revoke_rules_on_delete":false,"tags":{"Name":"vault-deployment-vault-instance-sg","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"egress":true,"id":true,"ingress":true,"name":true,"owner_id":true,"tags":{}}}},{"address":"aws_security_group_rule.bastion_allow_22","mode":"managed","type":"aws_security_group_rule","name":"bastion_allow_22","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow SSH traffic.","from_port":22,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.bastion.id","self":false,"to_port":22,"type":"ingress"},"after_unknown":{"cidr_blocks":[false],"id":true,"source_security_group_id":true}}},{"address":"aws_security_group_rule.bastion_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"bastion_allow_outbound","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow any outbound traffic.","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_group_id":"aws_security_group.bastion.id","self":false,"to_port":0,"type":"egress"},"after_unknown":{"cidr_blocks":[false],"id":true,"source_security_group_id":true}}},{"address":"aws_security_group_rule.kms_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"kms_allow_outbound","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow any outbound traffic.","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_group_id":"aws_security_group.kms_endpoint.id","self":false,"to_port":0,"type":"egress"},"after_unknown":{"cidr_blocks":[false],"id":true,"source_security_group_id":true}}},{"address":"aws_security_group_rule.load_balancer_allow_443","mode":"managed","type":"aws_security_group_rule","name":"load_balancer_allow_443","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow HTTPS traffic.","from_port":443,"ipv6_cidr_blocks":["::/0"],"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.load_balancer.id","self":false,"to_port":443,"type":"ingress"},"after_unknown":{"cidr_blocks":[false],"id":true,"ipv6_cidr_blocks":[false],"source_security_group_id":true}}},{"address":"aws_security_group_rule.load_balancer_allow_80","mode":"managed","type":"aws_security_group_rule","name":"load_balancer_allow_80","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow HTTP traffic.","from_port":80,"ipv6_cidr_blocks":["::/0"],"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.load_balancer.id","self":false,"to_port":80,"type":"ingress"},"after_unknown":{"cidr_blocks":[false],"id":true,"ipv6_cidr_blocks":[false],"source_security_group_id":true}}},{"address":"aws_security_group_rule.load_balancer_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"load_balancer_allow_outbound","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow any outbound traffic.","from_port":0,"ipv6_cidr_blocks":["::/0"],"prefix_list_ids":null,"protocol":"-1","security_group_id":"aws_security_group.load_balancer.id","self":false,"to_port":0,"type":"egress"},"after_unknown":{"cidr_blocks":[false],"id":true,"ipv6_cidr_blocks":[false],"source_security_group_id":true}}},{"address":"aws_security_group_rule.vault_instance_allow_22_bastion","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_22_bastion","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":null,"description":"Allow SSH traffic from vault bastion.","from_port":22,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.vault_instance.id","self":false,"source_security_group_id":"aws_security_group.bastion.id","to_port":22,"type":"ingress"},"after_unknown":{"id":true}}},{"address":"aws_security_group_rule.vault_instance_allow_443","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_443","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":null,"description":"Allow HTTPS traffic from vault instances.","from_port":443,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.kms_endpoint.id","self":false,"source_security_group_id":"aws_security_group.vault_instance.id","to_port":443,"type":"ingress"},"after_unknown":{"id":true}}},{"address":"aws_security_group_rule.vault_instance_allow_80","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_80","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":null,"description":"Allow HTTP traffic from vault instances.","from_port":80,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.kms_endpoint.id","self":false,"source_security_group_id":"aws_security_group.vault_instance.id","to_port":80,"type":"ingress"},"after_unknown":{"id":true}}},{"address":"aws_security_group_rule.vault_instance_allow_8200","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_8200","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":null,"description":"Allow traffic from Load Balancer.","from_port":8200,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.vault_instance.id","self":false,"source_security_group_id":"aws_security_group.load_balancer.id","to_port":8200,"type":"ingress"},"after_unknown":{"id":true}}},{"address":"aws_security_group_rule.vault_instance_allow_8201","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_8201","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":null,"description":"Allow traffic from fellow vault instances that have this SG.","from_port":8201,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"tcp","security_group_id":"aws_security_group.vault_instance.id","self":true,"to_port":8201,"type":"ingress"},"after_unknown":{"id":true,"source_security_group_id":true}}},{"address":"aws_security_group_rule.vault_instance_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_outbound","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"cidr_blocks":["0.0.0.0/0"],"description":"Allow any outbound traffic.","from_port":0,"ipv6_cidr_blocks":null,"prefix_list_ids":null,"protocol":"-1","security_group_id":"aws_security_group.vault_instance.id","self":false,"to_port":0,"type":"egress"},"after_unknown":{"cidr_blocks":[false],"id":true,"source_security_group_id":true}}},{"address":"aws_subnet.private[0]","mode":"managed","type":"aws_subnet","name":"private","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1a","cidr_block":"10.255.2.0/24","ipv6_cidr_block":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"Name":"vault-deployment-private-us-east-1a","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{}}}},{"address":"aws_subnet.private[1]","mode":"managed","type":"aws_subnet","name":"private","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":false,"availability_zone":"us-east-1b","cidr_block":"10.255.3.0/24","ipv6_cidr_block":null,"map_public_ip_on_launch":false,"outpost_arn":null,"tags":{"Name":"vault-deployment-private-us-east-1b","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{}}}},{"address":"aws_subnet.public[0]","mode":"managed","type":"aws_subnet","name":"public","index":0,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":true,"availability_zone":"us-east-1a","cidr_block":"10.255.0.0/24","map_public_ip_on_launch":true,"outpost_arn":null,"tags":{"Name":"vault-deployment-public-us-east-1a","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{}}}},{"address":"aws_subnet.public[1]","mode":"managed","type":"aws_subnet","name":"public","index":1,"provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_ipv6_address_on_creation":true,"availability_zone":"us-east-1b","cidr_block":"10.255.1.0/24","map_public_ip_on_launch":true,"outpost_arn":null,"tags":{"Name":"vault-deployment-public-us-east-1b","Project":"vault-deployment"},"timeouts":null,"vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"availability_zone_id":true,"id":true,"ipv6_cidr_block":true,"ipv6_cidr_block_association_id":true,"owner_id":true,"tags":{}}}},{"address":"aws_vpc.vault","mode":"managed","type":"aws_vpc","name":"vault","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"assign_generated_ipv6_cidr_block":true,"cidr_block":"10.255.0.0/20","enable_dns_hostnames":true,"enable_dns_support":true,"instance_tenancy":"default","tags":{"Name":"vault-deployment-vpc","Project":"vault-deployment"}},"after_unknown":{"arn":true,"default_network_acl_id":true,"default_route_table_id":true,"default_security_group_id":true,"dhcp_options_id":true,"enable_classiclink":true,"enable_classiclink_dns_support":true,"id":true,"ipv6_association_id":true,"ipv6_cidr_block":true,"main_route_table_id":true,"owner_id":true,"tags":{}}}},{"address":"aws_vpc_endpoint.dynamodb","mode":"managed","type":"aws_vpc_endpoint","name":"dynamodb","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"auto_accept":null,"private_dns_enabled":false,"route_table_ids":["aws_route_table.private.id"],"service_name":"com.amazonaws.us-east-1.dynamodb","tags":{"Name":"vault-deployment-dynamodb-endpoint","Project":"vault-deployment"},"timeouts":null,"vpc_endpoint_type":"Gateway","vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"cidr_blocks":true,"dns_entry":true,"id":true,"network_interface_ids":true,"owner_id":true,"policy":true,"prefix_list_id":true,"requester_managed":true,"route_table_ids":[false],"security_group_ids":true,"state":true,"subnet_ids":true,"tags":{}}}},{"address":"aws_vpc_endpoint.kms","mode":"managed","type":"aws_vpc_endpoint","name":"kms","provider_name":"aws","change":{"actions":["create"],"before":null,"after":{"auto_accept":null,"private_dns_enabled":true,"security_group_ids":["aws_security_group.kms_endpoint.id"],"service_name":"com.amazonaws.us-east-1.kms","subnet_ids":["aws_subnet.private[0].id","aws_subnet.private[1].id"],"tags":{"Name":"vault-deployment-kms-endpoint","Project":"vault-deployment"},"timeouts":null,"vpc_endpoint_type":"Interface","vpc_id":"aws_vpc.vault.id"},"after_unknown":{"arn":true,"cidr_blocks":true,"dns_entry":true,"id":true,"network_interface_ids":true,"owner_id":true,"policy":true,"prefix_list_id":true,"requester_managed":true,"route_table_ids":true,"security_group_ids":[false],"state":true,"subnet_ids":[false,false],"tags":{}}}},{"address":"data.aws_iam_policy_document.dynamodb_vault_policy","mode":"data","type":"aws_iam_policy_document","name":"dynamodb_vault_policy","provider_name":"aws","change":{"actions":["read"],"before":null,"after":{"override_json":null,"policy_id":null,"source_json":null,"statement":[{"actions":["dynamodb:BatchGetItem","dynamodb:BatchWriteItem","dynamodb:DeleteItem","dynamodb:DescribeTable","dynamodb:DescribeTimeToLive","dynamodb:GetItem","dynamodb:ListTagsOfResource","dynamodb:PutItem","dynamodb:UpdateItem"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["aws_dynamodb_table.vault_storage.arn"],"sid":"ManageTable"},{"actions":["dynamodb:GetRecords"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["aws_dynamodb_table.vault_storage.arn/stream/*"],"sid":"GetStreamRecords"},{"actions":["dynamodb:Query","dynamodb:Scan"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["aws_dynamodb_table.vault_storage.arn","aws_dynamodb_table.vault_storage.arn/index/*"],"sid":"QueryAndScanTable"}],"version":null},"after_unknown":{"id":true,"json":true,"statement":[{"actions":[false,false,false,false,false,false,false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false]},{"actions":[false],"condition":[],"not_principals":[],"principals":[],"resources":[false]},{"actions":[false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false,false]}]}}},{"address":"data.aws_iam_policy_document.kms_vault_policy","mode":"data","type":"aws_iam_policy_document","name":"kms_vault_policy","provider_name":"aws","change":{"actions":["read"],"before":null,"after":{"override_json":null,"policy_id":null,"source_json":null,"statement":[{"actions":["kms:Decrypt","kms:DescribeKey","kms:Encrypt"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["aws_kms_key.seal.arn"],"sid":"EncryptDecryptAndDescribe"}],"version":null},"after_unknown":{"id":true,"json":true,"statement":[{"actions":[false,false,false],"condition":[],"not_principals":[],"principals":[],"resources":[false]}]}}},{"address":"data.aws_iam_policy_document.s3_vault_policy","mode":"data","type":"aws_iam_policy_document","name":"s3_vault_policy","provider_name":"aws","change":{"actions":["read"],"before":null,"after":{"override_json":null,"policy_id":null,"source_json":null,"statement":[{"actions":["s3:PutObject"],"condition":[],"effect":"Allow","not_actions":null,"not_principals":[],"not_resources":null,"principals":[],"resources":["aws_s3_bucket.vault_data.arn/*"],"sid":"PutObjects"}],"version":null},"after_unknown":{"id":true,"json":true,"statement":[{"actions":[false],"condition":[],"not_principals":[],"principals":[],"resources":[false]}]}}},{"address":"local_file.userdata_compiled","mode":"managed","type":"local_file","name":"userdata_compiled","provider_name":"local","change":{"actions":["create"],"before":null,"after":{"content":"Content-Type: multipart/mixed; boundary=\"==BOUNDARY==\"\nMIME-Version: 1.0\n\n--==BOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -e\n\n# Run Order: 1\n# Run Frequency: only once, on first boot\n\n# Tasks:\n# - Install Dependencies\n# - Make users and directories\n# - Install download, unzip, and setup vault bin\n\n# Note: dollar-sign curly braces are template values from Terraform.\n# Non curly brace ones are normal bash variables...\n\nyum update -y\nyum install -y jq\n\n# Make the user\nuseradd --system --shell /sbin/nologin vault\n\n# Make the directories\nmkdir -p /opt/vault\nmkdir -p /opt/vault/bin\nmkdir -p /opt/vault/config\nmkdir -p /opt/vault/tls\n\n# Give corret permissions\nchmod 755 /opt/vault\nchmod 755 /opt/vault/bin\n\n# Change ownership to vault user\nchown -R vault:vault /opt/vault\n\n# Get the HashiCorp PGP\ncurl https://keybase.io/hashicorp/pgp_keys.asc | gpg --import\n\n# Download vault and signatures\ncurl -Os https://releases.hashicorp.com/vault/1.4.0/vault_1.4.0_linux_amd64.zip\ncurl -Os https://releases.hashicorp.com/vault/1.4.0/vault_1.4.0_SHA256SUMS\ncurl -Os https://releases.hashicorp.com/vault/1.4.0/vault_1.4.0_SHA256SUMS.sig\n\n# Verify Signatres\ngpg --verify vault_1.4.0_SHA256SUMS.sig vault_1.4.0_SHA256SUMS\ncat vault_1.4.0_SHA256SUMS | grep vault_1.4.0_linux_amd64.zip | sha256sum -c\n\n# unzip and move to /opt/vault/bin\nunzip vault_1.4.0_linux_amd64.zip\nmv vault /opt/vault/bin\n\n# give ownership to the vault user\nchown vault:vault /opt/vault/bin/vault\n\n# create a symlink\nln -s /opt/vault/bin/vault /usr/local/bin/vault\n\n# allow vault permissions to use mlock and prevent memory from swapping to disk\nsetcap cap_ipc_lock=+ep /opt/vault/bin/vault\n\n# cleanup files\nrm vault_1.4.0_linux_amd64.zip\nrm vault_1.4.0_SHA256SUMS\nrm vault_1.4.0_SHA256SUMS.sig\n\n--==BOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -e\n\n# Run Order: 2\n# Run Frequency: only once, on first boot\n\n# Tasks:\n# - Fetch needed data\n# - Create Self-Signed Certificate and Key\n\nINSTANCE_IP_ADDR=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\nINSTANCE_DNS_NAME=$(curl http://169.254.169.254/latest/meta-data/local-hostname)\n\n# Used for encryption between the load balancer and vault instances.\n# Th other alternatives are either creating an entire, private CA and hoping AWS\n# eventually adds the ability to add trusted CAs to load balancers...\n# ...or paying $400/month base for the ACM private CA.\nopenssl req -x509 -sha256 -nodes \\\n  -newkey rsa:4096 -days 3650 \\\n  -keyout /opt/vault/tls/vault.key -out /opt/vault/tls/vault.crt \\\n  -subj \"/CN=$INSTANCE_DNS_NAME\" \\\n  -extensions san \\\n  -config \u003c(cat /etc/pki/tls/openssl.cnf \u003c(echo -e \"\\n[san]\\nsubjectAltName=DNS:$INSTANCE_DNS_NAME,IP:$INSTANCE_IP_ADDR\"))\n\nchown vault:vault /opt/vault/tls/vault.key\nchown vault:vault /opt/vault/tls/vault.crt\n\nchmod 640 /opt/vault/tls/vault.key\nchmod 644 /opt/vault/tls/vault.crt\n\n# Trust the certificate\ncp /opt/vault/tls/vault.crt /etc/pki/tls/certs/vault.crt\n\n--==BOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -e\n\n# Run Order: 3\n# Run Frequency: only once, on first boot\n\n# Tasks:\n# - Make the vault config file\n# - Make the systemd service file\n\n# The vault config file\ncat \u003e /opt/vault/config/server.hcl \u003c\u003c- EOF\ncluster_name = \"vault-deployment\"\nmax_lease_ttl = \"192h\"\ndefault_lease_ttl = \"192h\"\nui  = \"true\"\n\n# Where can the Vault API be reached?  At DNS for the load balancer, or the CNAME created.\n# Note: this maps to the environment variable VAULT_API_ADDR not VAULT_ADDR\napi_addr = \"https://secrets.domain.com\"\n\n# For forwarding between vault servers.  Set to own ip.\ncluster_addr = \"https://INSTANCE_IP_ADDR:8201\"\n\n# Auto unseal the vault\nseal \"awskms\" {\n  region = \"us-east-1\"\n  kms_key_id = \"aws_kms_key.seal.key_id\"\n}\n\n# Listener for loopback\nlistener \"tcp\" {\n  address = \"127.0.0.1:8199\"\n  tls_disable = \"true\"\n}\n\n# Listener for private network\nlistener \"tcp\" {\n  address = \"INSTANCE_IP_ADDR:8200\"\n  cluster_address = \"INSTANCE_IP_ADDR:8201\"\n\n  tls_disable = \"false\"\n  tls_cert_file = \"/opt/vault/tls/vault.crt\"\n  tls_key_file = \"/opt/vault/tls/vault.key\"\n}\n\nstorage \"dynamodb\" {\n  ha_enabled = \"true\"\n  region = \"us-east-1\"\n  table = \"vault_storage\"\n}\nEOF\n\nchown vault:vault /opt/vault/config/server.hcl\n\n# The systemd service file\ncat \u003e /etc/systemd/system/vault.service \u003c\u003c- EOF\n[Unit]\nDescription=Vault Server on AWS\nRequires=network-online.target\nAfter=network-online.target\n\n[Service]\nUser=vault\nGroup=vault\nProtectSystem=full\nProtectHome=read-only\nPrivateTmp=yes\nPrivateDevices=yes\nSecureBits=keep-caps\nAmbientCapabilities=CAP_IPC_LOCK\nCapabilities=CAP_IPC_LOCK+ep\nCapabilityBoundingSet=CAP_SYSLOG CAP_IPC_LOCK\nNoNewPrivileges=yes\nExecStart=/opt/vault/bin/vault server -config=/opt/vault/config/ -log-level=info\nExecReload=/bin/kill --signal HUP \\$MAINPID\nKillMode=process\nKillSignal=SIGINT\nRestart=on-failure\nRestartSec=5\nTimeoutStopSec=30\nStartLimitInterval=60\nStartLimitBurst=3\nLimitNOFILE=65536\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n--==BOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -e\n\n# Run Order: 4\n# Run Frequency: only once, on first boot\n\n# Tasks:\n# - Replace values in configuration files with instance metadata\n# - Start vault\n\nINSTANCE_IP_ADDR=$(curl http://169.254.169.254/latest/meta-data/local-ipv4)\nsed -i -e \"s/INSTANCE_IP_ADDR/$INSTANCE_IP_ADDR/g\" /opt/vault/config/server.hcl\n\nsystemctl daemon-reload\nsystemctl enable vault\nsystemctl restart vault\n\n--==BOUNDARY==\nContent-Type: text/x-shellscript; charset=\"us-ascii\"\n\n#!/bin/bash\nset -e\n\n# Run Order: 5\n# Run Frequency: only once, on first boot\n\n# Tasks:\n# - Initialize Vault\n# - Create credentials file\n# - Encrypt the file via KMS\n# - Send the file to S3\n# - Delete the local file\n# - Erase bash history\n\n# Workaround to make sure the vault service is fully initialized.\nsleep 20\n\nexport VAULT_ADDR=\"http://127.0.0.1:8199\"\nexport AWS_DEFAULT_REGION=\"us-east-1\"\nexport VAULT_INITIALIZED=$(vault operator init -status) # avoid non-zero exit status\n\nfunction initialize_vault {\n  # initialize and pipe to file\n  vault operator init \u003e vault_credentials.txt\n\n  # encrypt it with the KMS key\n  aws kms encrypt --key-id aws_kms_key.seal.key_id --plaintext fileb://vault_credentials.txt --output text --query CiphertextBlob | base64 --decode \u003e vault_creds_encrypted\n\n  # send the encrypted file to the s3 bucket\n  aws s3 cp vault_creds_encrypted s3://aws_s3_bucket.vault_data.id/\n\n  # cleanup\n  rm vault_credentials.txt\n  rm vault_creds_encrypted\n  history -c\n  history -w\n}\n\nif [ \"$VAULT_INITIALIZED\" = \"Vault is initialized\" ]; then\n  echo \"Vault is already initialized.\"\nelse\n  echo \"Initializing vault...\"\n  initialize_vault\nfi\n\n--==BOUNDARY==--","content_base64":null,"directory_permission":"0777","file_permission":"0777","filename":"./temp/userdata_compiled.sh","sensitive_content":null,"source":null},"after_unknown":{"id":true}}},{"address":"local_file.vault_credentials","mode":"managed","type":"local_file","name":"vault_credentials","provider_name":"local","change":{"actions":["create"],"before":null,"after":{"content":"#!/bin/bash\n\n# This grabs the encrypted credentials file and decrypts it.\n\naws --profile default --region us-east-1 s3 cp s3://aws_s3_bucket.vault_data.id/vault_creds_encrypted ./temp/vault_creds_encrypted\naws --profile default --region us-east-1 kms decrypt --key-id aws_kms_key.seal.key_id --ciphertext-blob fileb://temp/vault_creds_encrypted --output text --query Plaintext | base64 --decode \u003e ./temp/vault_creds_decrypted\n\necho \"\"\necho \"Vault crednetials decrypted.  Find them at ./temp/vault_creds_decrypted\"\necho \"----\"\necho \"Load Balancer DNS Name: aws_lb.alb.dns_name\"\necho \"\"","content_base64":null,"directory_permission":"0777","file_permission":"0777","filename":"./temp/vault_credentials.sh","sensitive_content":null,"source":null},"after_unknown":{"id":true}}}],"output_changes":{"load_balancer_dns":{"actions":["create"],"before":null,"after":"aws_lb.alb.dns_name","after_unknown":false},"vpc_id":{"actions":["create"],"before":null,"after":"aws_vpc.vault.id","after_unknown":false},"vpc_ipv4_cidr":{"actions":["create"],"before":null,"after":"10.255.0.0/20","after_unknown":false},"vpc_ipv6_cidr":{"actions":["create"],"before":null,"after_unknown":true}},"prior_state":{"format_version":"0.1","terraform_version":"0.12.29","values":{"root_module":{"resources":[{"address":"data.aws_availability_zones.available","mode":"data","type":"aws_availability_zones","name":"available","provider_name":"aws","schema_version":0,"values":{"all_availability_zones":null,"exclude_names":null,"exclude_zone_ids":null,"filter":null,"group_names":["us-east-1"],"id":"us-east-1","names":["us-east-1a","us-east-1b","us-east-1c","us-east-1d","us-east-1e","us-east-1f"],"state":"available","zone_ids":["use1-az1","use1-az2","use1-az4","use1-az6","use1-az3","use1-az5"]}},{"address":"data.aws_caller_identity.current","mode":"data","type":"aws_caller_identity","name":"current","provider_name":"aws","schema_version":0,"values":{"account_id":"167389268608","arn":"arn:aws:sts::167389268608:assumed-role/AWSReservedSSO_admin_in_develop_7b13d69800adca00/y@indeni.com","id":"167389268608","user_id":"AROASN6JNRKAJ56VZ6FY7:y@indeni.com"}},{"address":"data.aws_iam_policy_document.asg_trust_policy","mode":"data","type":"aws_iam_policy_document","name":"asg_trust_policy","provider_name":"aws","schema_version":0,"values":{"id":"1903849331","json":"{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      }\n    }\n  ]\n}","override_json":null,"policy_id":null,"source_json":null,"statement":[{"actions":["sts:AssumeRole"],"condition":[],"effect":"Allow","not_actions":[],"not_principals":[],"not_resources":[],"principals":[{"identifiers":["ec2.amazonaws.com"],"type":"Service"}],"resources":[],"sid":""}],"version":"2012-10-17"}},{"address":"data.aws_region.current","mode":"data","type":"aws_region","name":"current","provider_name":"aws","schema_version":0,"values":{"description":"US East (N. Virginia)","endpoint":"ec2.us-east-1.amazonaws.com","id":"us-east-1","name":"us-east-1"}},{"address":"data.aws_ssm_parameter.latest_ami","mode":"data","type":"aws_ssm_parameter","name":"latest_ami","provider_name":"aws","schema_version":0,"values":{"arn":"arn:aws:ssm:us-east-1:167389268608:parameter/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2","id":"/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2","name":"/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2","type":"String","value":"ami-047a51fa27710816e","version":37,"with_decryption":true}},{"address":"data.aws_vpc_endpoint_service.dynamodb","mode":"data","type":"aws_vpc_endpoint_service","name":"dynamodb","provider_name":"aws","schema_version":0,"values":{"acceptance_required":false,"arn":"arn:aws:ec2:us-east-1:167389268608:vpc-endpoint-service/vpce-svc-099eb39957ebe7ecc","availability_zones":["us-east-1a","us-east-1b","us-east-1c","us-east-1d","us-east-1e","us-east-1f"],"base_endpoint_dns_names":["dynamodb.us-east-1.amazonaws.com"],"filter":null,"id":"2816157640","manages_vpc_endpoints":false,"owner":"amazon","private_dns_name":"","service":"dynamodb","service_id":"vpce-svc-099eb39957ebe7ecc","service_name":"com.amazonaws.us-east-1.dynamodb","service_type":"Gateway","tags":{},"vpc_endpoint_policy_supported":true}},{"address":"data.aws_vpc_endpoint_service.kms","mode":"data","type":"aws_vpc_endpoint_service","name":"kms","provider_name":"aws","schema_version":0,"values":{"acceptance_required":false,"arn":"arn:aws:ec2:us-east-1:167389268608:vpc-endpoint-service/vpce-svc-06e89c5fa1e953a07","availability_zones":["us-east-1a","us-east-1b","us-east-1c","us-east-1d","us-east-1e","us-east-1f"],"base_endpoint_dns_names":["kms.us-east-1.vpce.amazonaws.com"],"filter":null,"id":"140981279","manages_vpc_endpoints":false,"owner":"amazon","private_dns_name":"kms.us-east-1.amazonaws.com","service":"kms","service_id":"vpce-svc-06e89c5fa1e953a07","service_name":"com.amazonaws.us-east-1.kms","service_type":"Interface","tags":{},"vpc_endpoint_policy_supported":true}}]}}},"configuration":{"provider_config":{"aws":{"name":"aws","expressions":{"profile":{"references":["var.aws_profile"]},"region":{"references":["var.aws_default_region"]}}}},"root_module":{"outputs":{"load_balancer_dns":{"expression":{"references":["aws_lb.alb"]}},"vpc_id":{"expression":{"references":["aws_vpc.vault"]}},"vpc_ipv4_cidr":{"expression":{"references":["aws_vpc.vault"]}},"vpc_ipv6_cidr":{"expression":{"references":["aws_vpc.vault"]}}},"resources":[{"address":"aws_autoscaling_group.vault-asg","mode":"managed","type":"aws_autoscaling_group","name":"vault-asg","provider_config_key":"aws","expressions":{"desired_capacity":{"references":["var.vault_instance_count"]},"enabled_metrics":{"constant_value":["GroupDesiredCapacity","GroupInServiceCapacity","GroupPendingCapacity","GroupMinSize","GroupMaxSize","GroupInServiceInstances","GroupPendingInstances","GroupStandbyInstances","GroupStandbyCapacity","GroupTerminatingCapacity","GroupTerminatingInstances","GroupTotalCapacity","GroupTotalInstances"]},"health_check_grace_period":{"constant_value":300},"health_check_type":{"constant_value":"EC2"},"launch_template":[{"id":{"references":["aws_launch_template.vault_instance"]},"version":{"references":["aws_launch_template.vault_instance"]}}],"max_size":{"references":["var.vault_instance_count"]},"min_size":{"references":["var.vault_instance_count"]},"name_prefix":{"references":["var.main_project_tag"]},"tags":{"references":["var.main_project_tag","var.main_project_tag"]},"target_group_arns":{"references":["aws_lb_target_group.alb_targets"]},"termination_policies":{"constant_value":["OldestLaunchTemplate"]},"vpc_zone_identifier":{"references":["aws_subnet.private"]},"wait_for_capacity_timeout":{"constant_value":0}},"schema_version":0,"raw_data":{"FileName":"ec2-auto-scaling-group.tf","StartLine":3,"EndLine":54}},{"address":"aws_dynamodb_table.vault_storage","mode":"managed","type":"aws_dynamodb_table","name":"vault_storage","provider_config_key":"aws","expressions":{"attribute":[{"name":{"constant_value":"Path"},"type":{"constant_value":"S"}},{"name":{"constant_value":"Key"},"type":{"constant_value":"S"}}],"billing_mode":{"constant_value":"PAY_PER_REQUEST"},"hash_key":{"constant_value":"Path"},"name":{"references":["var.dynamodb_table_name"]},"range_key":{"constant_value":"Key"},"tags":{"references":["var.dynamodb_table_name","var.main_project_tag"]}},"schema_version":1,"raw_data":{"FileName":"dynamodb.tf","StartLine":3,"EndLine":23}},{"address":"aws_egress_only_internet_gateway.eigw","mode":"managed","type":"aws_egress_only_internet_gateway","name":"eigw","provider_config_key":"aws","expressions":{"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":0,"raw_data":{"FileName":"vpc.tf","StartLine":39,"EndLine":41}},{"address":"aws_eip.nat","mode":"managed","type":"aws_eip","name":"nat","provider_config_key":"aws","expressions":{"tags":{"references":["var.main_project_tag","var.main_project_tag","var.vpc_tags"]},"vpc":{"constant_value":true}},"schema_version":0,"count_expression":{"references":["var.operator_mode"]},"depends_on":["aws_internet_gateway.igw"],"raw_data":{"FileName":"vpc.tf","StartLine":46,"EndLine":58}},{"address":"aws_iam_instance_profile.vault_instance_profile","mode":"managed","type":"aws_iam_instance_profile","name":"vault_instance_profile","provider_config_key":"aws","expressions":{"name_prefix":{"references":["var.main_project_tag"]},"role":{"references":["aws_iam_role.vault_instance"]}},"schema_version":0,"raw_data":{"FileName":"iam-roles.tf","StartLine":32,"EndLine":35}},{"address":"aws_iam_role.vault_instance","mode":"managed","type":"aws_iam_role","name":"vault_instance","provider_config_key":"aws","expressions":{"assume_role_policy":{"references":["data.aws_iam_policy_document.asg_trust_policy"]},"name_prefix":{"references":["var.main_project_tag"]}},"schema_version":0,"raw_data":{"FileName":"iam-roles.tf","StartLine":5,"EndLine":8}},{"address":"aws_iam_role_policy.vault_instance_dynamodb_policy","mode":"managed","type":"aws_iam_role_policy","name":"vault_instance_dynamodb_policy","provider_config_key":"aws","expressions":{"name_prefix":{"references":["var.main_project_tag"]},"policy":{"references":["data.aws_iam_policy_document.dynamodb_vault_policy"]},"role":{"references":["aws_iam_role.vault_instance"]}},"schema_version":0,"raw_data":{"FileName":"iam-roles.tf","StartLine":18,"EndLine":22}},{"address":"aws_iam_role_policy.vault_instance_kms_policy","mode":"managed","type":"aws_iam_role_policy","name":"vault_instance_kms_policy","provider_config_key":"aws","expressions":{"name_prefix":{"references":["var.main_project_tag"]},"policy":{"references":["data.aws_iam_policy_document.kms_vault_policy"]},"role":{"references":["aws_iam_role.vault_instance"]}},"schema_version":0,"raw_data":{"FileName":"iam-roles.tf","StartLine":12,"EndLine":16}},{"address":"aws_iam_role_policy.vault_instance_s3_policy","mode":"managed","type":"aws_iam_role_policy","name":"vault_instance_s3_policy","provider_config_key":"aws","expressions":{"name_prefix":{"references":["var.main_project_tag"]},"policy":{"references":["data.aws_iam_policy_document.s3_vault_policy"]},"role":{"references":["aws_iam_role.vault_instance"]}},"schema_version":0,"raw_data":{"FileName":"iam-roles.tf","StartLine":24,"EndLine":28}},{"address":"aws_instance.bastion","mode":"managed","type":"aws_instance","name":"bastion","provider_config_key":"aws","expressions":{"ami":{"references":["var.use_lastest_ami","data.aws_ssm_parameter.latest_ami"]},"associate_public_ip_address":{"constant_value":true},"instance_type":{"constant_value":"t2.micro"},"key_name":{"references":["var.ec2_key_pair_name"]},"subnet_id":{"references":["aws_subnet.public[0]"]},"tags":{"references":["var.main_project_tag","var.main_project_tag"]},"vpc_security_group_ids":{"references":["aws_security_group.bastion"]}},"schema_version":1,"count_expression":{"references":["var.operator_mode"]},"raw_data":{"FileName":"ec2-bastion.tf","StartLine":4,"EndLine":18}},{"address":"aws_internet_gateway.igw","mode":"managed","type":"aws_internet_gateway","name":"igw","provider_config_key":"aws","expressions":{"tags":{"references":["var.main_project_tag","var.main_project_tag","var.vpc_tags"]},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":0,"raw_data":{"FileName":"vpc.tf","StartLine":28,"EndLine":36}},{"address":"aws_kms_alias.seal","mode":"managed","type":"aws_kms_alias","name":"seal","provider_config_key":"aws","expressions":{"name":{"references":["var.main_project_tag"]},"target_key_id":{"references":["aws_kms_key.seal"]}},"schema_version":0,"raw_data":{"FileName":"kms.tf","StartLine":13,"EndLine":16}},{"address":"aws_kms_key.seal","mode":"managed","type":"aws_kms_key","name":"seal","provider_config_key":"aws","expressions":{"description":{"constant_value":"The KMS key to unseal Vault."},"enable_key_rotation":{"constant_value":true},"tags":{"references":["var.main_project_tag","var.main_project_tag","var.kms_tags"]}},"schema_version":0,"raw_data":{"FileName":"kms.tf","StartLine":2,"EndLine":11}},{"address":"aws_launch_template.vault_instance","mode":"managed","type":"aws_launch_template","name":"vault_instance","provider_config_key":"aws","expressions":{"iam_instance_profile":[{"arn":{"references":["aws_iam_instance_profile.vault_instance_profile"]}}],"image_id":{"references":["var.use_lastest_ami","data.aws_ssm_parameter.latest_ami"]},"instance_type":{"references":["var.vault_instance_type"]},"key_name":{"references":["var.ec2_key_pair_name"]},"name_prefix":{"references":["var.main_project_tag"]},"tag_specifications":[{"resource_type":{"constant_value":"instance"},"tags":{"references":["var.main_project_tag","var.main_project_tag"]}},{"resource_type":{"constant_value":"volume"},"tags":{"references":["var.main_project_tag","var.main_project_tag"]}}],"tags":{"references":["var.main_project_tag","var.main_project_tag"]},"user_data":{"references":["path.module","var.vault_version","var.main_project_tag","var.domain_name","aws_kms_key.seal","data.aws_region.current","var.dynamodb_table_name","aws_s3_bucket.vault_data"]},"vpc_security_group_ids":{"references":["aws_security_group.vault_instance"]}},"schema_version":0,"raw_data":{"FileName":"ec2-launch-template.tf","StartLine":2,"EndLine":45}},{"address":"aws_lb.alb","mode":"managed","type":"aws_lb","name":"alb","provider_config_key":"aws","expressions":{"idle_timeout":{"constant_value":60},"internal":{"references":["var.private_mode"]},"ip_address_type":{"references":["var.private_mode"]},"load_balancer_type":{"constant_value":"application"},"name_prefix":{"constant_value":"vault-"},"security_groups":{"references":["aws_security_group.load_balancer"]},"subnets":{"references":["aws_subnet.public"]},"tags":{"references":["var.main_project_tag","var.main_project_tag"]}},"schema_version":0,"raw_data":{"FileName":"ec2-load-balancer.tf","StartLine":9,"EndLine":25}},{"address":"aws_lb_listener.alb_http_redirect","mode":"managed","type":"aws_lb_listener","name":"alb_http_redirect","provider_config_key":"aws","expressions":{"default_action":[{"redirect":[{"host":{"constant_value":"#{host}"},"path":{"constant_value":"/#{path}"},"port":{"constant_value":443},"protocol":{"constant_value":"HTTPS"},"query":{"constant_value":"#{query}"},"status_code":{"constant_value":"HTTP_301"}}],"type":{"constant_value":"redirect"}}],"load_balancer_arn":{"references":["aws_lb.alb"]},"port":{"constant_value":80},"protocol":{"constant_value":"HTTP"}},"schema_version":0,"raw_data":{"FileName":"ec2-load-balancer.tf","StartLine":56,"EndLine":75}},{"address":"aws_lb_listener.alb_https","mode":"managed","type":"aws_lb_listener","name":"alb_https","provider_config_key":"aws","expressions":{"default_action":[{"target_group_arn":{"references":["aws_lb_target_group.alb_targets"]},"type":{"constant_value":"forward"}}],"load_balancer_arn":{"references":["aws_lb.alb"]},"port":{"constant_value":443},"protocol":{"constant_value":"HTTPS"},"ssl_policy":{"constant_value":"ELBSecurityPolicy-FS-2018-06"}},"schema_version":0,"raw_data":{"FileName":"ec2-load-balancer.tf","StartLine":78,"EndLine":88}},{"address":"aws_lb_target_group.alb_targets","mode":"managed","type":"aws_lb_target_group","name":"alb_targets","provider_config_key":"aws","expressions":{"deregistration_delay":{"constant_value":30},"health_check":[{"enabled":{"constant_value":true},"healthy_threshold":{"constant_value":3},"interval":{"constant_value":10},"matcher":{"constant_value":"200"},"path":{"constant_value":"/v1/sys/health"},"protocol":{"constant_value":"HTTPS"},"timeout":{"constant_value":5},"unhealthy_threshold":{"constant_value":3}}],"name_prefix":{"constant_value":"vault-"},"port":{"constant_value":8200},"protocol":{"constant_value":"HTTPS"},"tags":{"references":["var.main_project_tag","var.main_project_tag"]},"target_type":{"constant_value":"instance"},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":0,"raw_data":{"FileName":"ec2-load-balancer.tf","StartLine":28,"EndLine":51}},{"address":"aws_nat_gateway.nat","mode":"managed","type":"aws_nat_gateway","name":"nat","provider_config_key":"aws","expressions":{"allocation_id":{"references":["aws_eip.nat[0]"]},"subnet_id":{"references":["aws_subnet.public[0]"]},"tags":{"references":["var.main_project_tag","var.main_project_tag","var.vpc_tags"]}},"schema_version":0,"count_expression":{"references":["var.operator_mode"]},"depends_on":["aws_internet_gateway.igw","aws_eip.nat"],"raw_data":{"FileName":"vpc.tf","StartLine":61,"EndLine":77}},{"address":"aws_route.accepter_peering_route","mode":"managed","type":"aws_route","name":"accepter_peering_route","provider_config_key":"aws","expressions":{"destination_cidr_block":{"references":["aws_vpc.vault"]},"route_table_id":{"references":["data.aws_vpc.peered_vpc","count.index"]},"vpc_peering_connection_id":{"references":["aws_vpc_peering_connection.vault","count.index"]}},"schema_version":0,"count_expression":{"references":["var.private_mode","var.peered_vpc_ids","var.peered_vpc_ids"]},"raw_data":{"FileName":"vpc.tf","StartLine":312,"EndLine":318}},{"address":"aws_route.private_internet_access","mode":"managed","type":"aws_route","name":"private_internet_access","provider_config_key":"aws","expressions":{"destination_cidr_block":{"constant_value":"0.0.0.0/0"},"nat_gateway_id":{"references":["aws_nat_gateway.nat[0]"]},"route_table_id":{"references":["aws_route_table.private"]}},"schema_version":0,"count_expression":{"references":["var.operator_mode"]},"raw_data":{"FileName":"vpc.tf","StartLine":119,"EndLine":125}},{"address":"aws_route.private_internet_access_ipv6","mode":"managed","type":"aws_route","name":"private_internet_access_ipv6","provider_config_key":"aws","expressions":{"destination_ipv6_cidr_block":{"constant_value":"::/0"},"egress_only_gateway_id":{"references":["aws_egress_only_internet_gateway.eigw"]},"route_table_id":{"references":["aws_route_table.private"]}},"schema_version":0,"count_expression":{"references":["var.operator_mode"]},"raw_data":{"FileName":"vpc.tf","StartLine":127,"EndLine":133}},{"address":"aws_route.public_internet_access","mode":"managed","type":"aws_route","name":"public_internet_access","provider_config_key":"aws","expressions":{"destination_cidr_block":{"constant_value":"0.0.0.0/0"},"gateway_id":{"references":["aws_internet_gateway.igw"]},"route_table_id":{"references":["aws_route_table.public"]}},"schema_version":0,"raw_data":{"FileName":"vpc.tf","StartLine":102,"EndLine":106}},{"address":"aws_route.requester_peering_route","mode":"managed","type":"aws_route","name":"requester_peering_route","provider_config_key":"aws","expressions":{"destination_cidr_block":{"references":["data.aws_vpc.peered_vpc","count.index"]},"route_table_id":{"references":["aws_route_table.public"]},"vpc_peering_connection_id":{"references":["aws_vpc_peering_connection.vault","count.index"]}},"schema_version":0,"count_expression":{"references":["var.private_mode","var.peered_vpc_ids","var.peered_vpc_ids"]},"raw_data":{"FileName":"vpc.tf","StartLine":301,"EndLine":307}},{"address":"aws_route_table.private","mode":"managed","type":"aws_route_table","name":"private","provider_config_key":"aws","expressions":{"tags":{"references":["var.main_project_tag","var.main_project_tag","var.vpc_tags"]},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":0,"raw_data":{"FileName":"vpc.tf","StartLine":109,"EndLine":116}},{"address":"aws_route_table.public","mode":"managed","type":"aws_route_table","name":"public","provider_config_key":"aws","expressions":{"tags":{"references":["var.main_project_tag","var.main_project_tag","var.vpc_tags"]},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":0,"raw_data":{"FileName":"vpc.tf","StartLine":92,"EndLine":99}},{"address":"aws_route_table_association.private","mode":"managed","type":"aws_route_table_association","name":"private","provider_config_key":"aws","expressions":{"route_table_id":{"references":["aws_route_table.private"]},"subnet_id":{"references":["aws_subnet.private","count.index"]}},"schema_version":0,"count_expression":{"references":["var.vpc_private_subnet_count"]},"raw_data":{"FileName":"vpc.tf","StartLine":201,"EndLine":206}},{"address":"aws_route_table_association.public","mode":"managed","type":"aws_route_table_association","name":"public","provider_config_key":"aws","expressions":{"route_table_id":{"references":["aws_route_table.public"]},"subnet_id":{"references":["aws_subnet.public","count.index"]}},"schema_version":0,"count_expression":{"references":["var.vpc_public_subnet_count"]},"raw_data":{"FileName":"vpc.tf","StartLine":193,"EndLine":198}},{"address":"aws_s3_bucket.vault_data","mode":"managed","type":"aws_s3_bucket","name":"vault_data","provider_config_key":"aws","expressions":{"bucket_prefix":{"references":["var.main_project_tag"]},"server_side_encryption_configuration":[{"rule":[{"apply_server_side_encryption_by_default":[{"sse_algorithm":{"constant_value":"AES256"}}]}]}],"tags":{"references":["var.main_project_tag"]}},"schema_version":0,"raw_data":{"FileName":"s3.tf","StartLine":4,"EndLine":16}},{"address":"aws_s3_bucket_public_access_block.vault_data","mode":"managed","type":"aws_s3_bucket_public_access_block","name":"vault_data","provider_config_key":"aws","expressions":{"block_public_acls":{"constant_value":true},"block_public_policy":{"constant_value":true},"bucket":{"references":["aws_s3_bucket.vault_data"]},"ignore_public_acls":{"constant_value":true},"restrict_public_buckets":{"constant_value":true}},"schema_version":0,"raw_data":{"FileName":"s3.tf","StartLine":19,"EndLine":25}},{"address":"aws_security_group.bastion","mode":"managed","type":"aws_security_group","name":"bastion","provider_config_key":"aws","expressions":{"description":{"constant_value":"Firewall for the operator bastion instance"},"name_prefix":{"references":["var.main_project_tag"]},"tags":{"references":["var.main_project_tag","var.main_project_tag"]},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":1,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":104,"EndLine":112}},{"address":"aws_security_group.kms_endpoint","mode":"managed","type":"aws_security_group","name":"kms_endpoint","provider_config_key":"aws","expressions":{"description":{"constant_value":"Firewall for the KMS Endpoint."},"name_prefix":{"references":["var.main_project_tag"]},"tags":{"references":["var.main_project_tag","var.main_project_tag"]},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":1,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":138,"EndLine":146}},{"address":"aws_security_group.load_balancer","mode":"managed","type":"aws_security_group","name":"load_balancer","provider_config_key":"aws","expressions":{"description":{"constant_value":"Firewall for the application load balancer fronting the vault instances."},"name_prefix":{"references":["var.main_project_tag"]},"tags":{"references":["var.main_project_tag","var.main_project_tag"]},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":1,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":4,"EndLine":12}},{"address":"aws_security_group.vault_instance","mode":"managed","type":"aws_security_group","name":"vault_instance","provider_config_key":"aws","expressions":{"description":{"constant_value":"Firewall for the vault instances."},"name_prefix":{"references":["var.main_project_tag"]},"tags":{"references":["var.main_project_tag","var.main_project_tag"]},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":1,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":52,"EndLine":60}},{"address":"aws_security_group_rule.bastion_allow_22","mode":"managed","type":"aws_security_group_rule","name":"bastion_allow_22","provider_config_key":"aws","expressions":{"cidr_blocks":{"references":["var.allowed_bastion_cidr_blocks"]},"description":{"constant_value":"Allow SSH traffic."},"from_port":{"constant_value":22},"ipv6_cidr_blocks":{"references":["var.allowed_bastion_cidr_blocks_ipv6","var.allowed_bastion_cidr_blocks_ipv6"]},"protocol":{"constant_value":"tcp"},"security_group_id":{"references":["aws_security_group.bastion"]},"to_port":{"constant_value":22},"type":{"constant_value":"ingress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":114,"EndLine":123}},{"address":"aws_security_group_rule.bastion_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"bastion_allow_outbound","provider_config_key":"aws","expressions":{"cidr_blocks":{"constant_value":["0.0.0.0/0"]},"description":{"constant_value":"Allow any outbound traffic."},"from_port":{"constant_value":0},"ipv6_cidr_blocks":{"references":["var.allowed_bastion_cidr_blocks_ipv6"]},"protocol":{"constant_value":"-1"},"security_group_id":{"references":["aws_security_group.bastion"]},"to_port":{"constant_value":0},"type":{"constant_value":"egress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":125,"EndLine":134}},{"address":"aws_security_group_rule.kms_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"kms_allow_outbound","provider_config_key":"aws","expressions":{"cidr_blocks":{"constant_value":["0.0.0.0/0"]},"description":{"constant_value":"Allow any outbound traffic."},"from_port":{"constant_value":0},"protocol":{"constant_value":"-1"},"security_group_id":{"references":["aws_security_group.kms_endpoint"]},"to_port":{"constant_value":0},"type":{"constant_value":"egress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":168,"EndLine":176}},{"address":"aws_security_group_rule.load_balancer_allow_443","mode":"managed","type":"aws_security_group_rule","name":"load_balancer_allow_443","provider_config_key":"aws","expressions":{"cidr_blocks":{"references":["var.allowed_traffic_cidr_blocks"]},"description":{"constant_value":"Allow HTTPS traffic."},"from_port":{"constant_value":443},"ipv6_cidr_blocks":{"references":["var.allowed_traffic_cidr_blocks_ipv6","var.allowed_traffic_cidr_blocks_ipv6"]},"protocol":{"constant_value":"tcp"},"security_group_id":{"references":["aws_security_group.load_balancer"]},"to_port":{"constant_value":443},"type":{"constant_value":"ingress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":25,"EndLine":34}},{"address":"aws_security_group_rule.load_balancer_allow_80","mode":"managed","type":"aws_security_group_rule","name":"load_balancer_allow_80","provider_config_key":"aws","expressions":{"cidr_blocks":{"references":["var.allowed_traffic_cidr_blocks"]},"description":{"constant_value":"Allow HTTP traffic."},"from_port":{"constant_value":80},"ipv6_cidr_blocks":{"references":["var.allowed_traffic_cidr_blocks_ipv6","var.allowed_traffic_cidr_blocks_ipv6"]},"protocol":{"constant_value":"tcp"},"security_group_id":{"references":["aws_security_group.load_balancer"]},"to_port":{"constant_value":80},"type":{"constant_value":"ingress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":14,"EndLine":23}},{"address":"aws_security_group_rule.load_balancer_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"load_balancer_allow_outbound","provider_config_key":"aws","expressions":{"cidr_blocks":{"constant_value":["0.0.0.0/0"]},"description":{"constant_value":"Allow any outbound traffic."},"from_port":{"constant_value":0},"ipv6_cidr_blocks":{"references":["var.allowed_traffic_cidr_blocks_ipv6"]},"protocol":{"constant_value":"-1"},"security_group_id":{"references":["aws_security_group.load_balancer"]},"to_port":{"constant_value":0},"type":{"constant_value":"egress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":38,"EndLine":47}},{"address":"aws_security_group_rule.vault_instance_allow_22_bastion","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_22_bastion","provider_config_key":"aws","expressions":{"description":{"constant_value":"Allow SSH traffic from vault bastion."},"from_port":{"constant_value":22},"protocol":{"constant_value":"tcp"},"security_group_id":{"references":["aws_security_group.vault_instance"]},"source_security_group_id":{"references":["aws_security_group.bastion"]},"to_port":{"constant_value":22},"type":{"constant_value":"ingress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":82,"EndLine":90}},{"address":"aws_security_group_rule.vault_instance_allow_443","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_443","provider_config_key":"aws","expressions":{"description":{"constant_value":"Allow HTTPS traffic from vault instances."},"from_port":{"constant_value":443},"protocol":{"constant_value":"tcp"},"security_group_id":{"references":["aws_security_group.kms_endpoint"]},"source_security_group_id":{"references":["aws_security_group.vault_instance"]},"to_port":{"constant_value":443},"type":{"constant_value":"ingress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":158,"EndLine":166}},{"address":"aws_security_group_rule.vault_instance_allow_80","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_80","provider_config_key":"aws","expressions":{"description":{"constant_value":"Allow HTTP traffic from vault instances."},"from_port":{"constant_value":80},"protocol":{"constant_value":"tcp"},"security_group_id":{"references":["aws_security_group.kms_endpoint"]},"source_security_group_id":{"references":["aws_security_group.vault_instance"]},"to_port":{"constant_value":80},"type":{"constant_value":"ingress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":148,"EndLine":156}},{"address":"aws_security_group_rule.vault_instance_allow_8200","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_8200","provider_config_key":"aws","expressions":{"description":{"constant_value":"Allow traffic from Load Balancer."},"from_port":{"constant_value":8200},"protocol":{"constant_value":"tcp"},"security_group_id":{"references":["aws_security_group.vault_instance"]},"source_security_group_id":{"references":["aws_security_group.load_balancer"]},"to_port":{"constant_value":8200},"type":{"constant_value":"ingress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":62,"EndLine":70}},{"address":"aws_security_group_rule.vault_instance_allow_8201","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_8201","provider_config_key":"aws","expressions":{"description":{"constant_value":"Allow traffic from fellow vault instances that have this SG."},"from_port":{"constant_value":8201},"protocol":{"constant_value":"tcp"},"security_group_id":{"references":["aws_security_group.vault_instance"]},"self":{"constant_value":true},"to_port":{"constant_value":8201},"type":{"constant_value":"ingress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":72,"EndLine":80}},{"address":"aws_security_group_rule.vault_instance_allow_outbound","mode":"managed","type":"aws_security_group_rule","name":"vault_instance_allow_outbound","provider_config_key":"aws","expressions":{"cidr_blocks":{"constant_value":["0.0.0.0/0"]},"description":{"constant_value":"Allow any outbound traffic."},"from_port":{"constant_value":0},"protocol":{"constant_value":"-1"},"security_group_id":{"references":["aws_security_group.vault_instance"]},"to_port":{"constant_value":0},"type":{"constant_value":"egress"}},"schema_version":2,"raw_data":{"FileName":"vpc-security-groups.tf","StartLine":92,"EndLine":100}},{"address":"aws_subnet.private","mode":"managed","type":"aws_subnet","name":"private","provider_config_key":"aws","expressions":{"availability_zone":{"references":["data.aws_availability_zones.available","count.index"]},"cidr_block":{"references":["aws_vpc.vault","count.index","var.vpc_public_subnet_count"]},"tags":{"references":["var.main_project_tag","data.aws_availability_zones.available","count.index","var.main_project_tag","var.vpc_tags"]},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":1,"count_expression":{"references":["var.vpc_private_subnet_count"]},"raw_data":{"FileName":"vpc.tf","StartLine":166,"EndLine":180}},{"address":"aws_subnet.public","mode":"managed","type":"aws_subnet","name":"public","provider_config_key":"aws","expressions":{"assign_ipv6_address_on_creation":{"constant_value":true},"availability_zone":{"references":["data.aws_availability_zones.available","count.index"]},"cidr_block":{"references":["aws_vpc.vault","count.index"]},"ipv6_cidr_block":{"references":["aws_vpc.vault","count.index"]},"map_public_ip_on_launch":{"constant_value":true},"tags":{"references":["var.main_project_tag","data.aws_availability_zones.available","count.index","var.main_project_tag","var.vpc_tags"]},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":1,"count_expression":{"references":["var.vpc_public_subnet_count"]},"raw_data":{"FileName":"vpc.tf","StartLine":147,"EndLine":163}},{"address":"aws_vpc.vault","mode":"managed","type":"aws_vpc","name":"vault","provider_config_key":"aws","expressions":{"assign_generated_ipv6_cidr_block":{"constant_value":true},"cidr_block":{"references":["var.vpc_cidr"]},"enable_dns_hostnames":{"constant_value":true},"enable_dns_support":{"constant_value":true},"instance_tenancy":{"references":["var.vpc_instance_tenancy"]},"tags":{"references":["var.main_project_tag","var.main_project_tag","var.vpc_tags"]}},"schema_version":1,"raw_data":{"FileName":"vpc.tf","StartLine":2,"EndLine":14}},{"address":"aws_vpc_endpoint.dynamodb","mode":"managed","type":"aws_vpc_endpoint","name":"dynamodb","provider_config_key":"aws","expressions":{"route_table_ids":{"references":["aws_route_table.private"]},"service_name":{"references":["data.aws_vpc_endpoint_service.dynamodb"]},"tags":{"references":["var.main_project_tag","var.main_project_tag","var.vpc_tags"]},"vpc_endpoint_type":{"constant_value":"Gateway"},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":0,"raw_data":{"FileName":"vpc.tf","StartLine":246,"EndLine":260}},{"address":"aws_vpc_endpoint.kms","mode":"managed","type":"aws_vpc_endpoint","name":"kms","provider_config_key":"aws","expressions":{"private_dns_enabled":{"constant_value":true},"security_group_ids":{"references":["aws_security_group.kms_endpoint"]},"service_name":{"references":["data.aws_vpc_endpoint_service.kms"]},"subnet_ids":{"references":["aws_subnet.private"]},"tags":{"references":["var.main_project_tag","var.main_project_tag","var.vpc_tags"]},"vpc_endpoint_type":{"constant_value":"Interface"},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":0,"raw_data":{"FileName":"vpc.tf","StartLine":223,"EndLine":239}},{"address":"aws_vpc_peering_connection.vault","mode":"managed","type":"aws_vpc_peering_connection","name":"vault","provider_config_key":"aws","expressions":{"accepter":[{"allow_remote_vpc_dns_resolution":{"constant_value":true}}],"auto_accept":{"constant_value":true},"peer_vpc_id":{"references":["var.peered_vpc_ids","count.index"]},"requester":[{"allow_remote_vpc_dns_resolution":{"constant_value":true}}],"tags":{"references":["var.main_project_tag","count.index","var.main_project_tag","var.vpc_tags"]},"vpc_id":{"references":["aws_vpc.vault"]}},"schema_version":0,"count_expression":{"references":["var.private_mode","var.peered_vpc_ids","var.peered_vpc_ids"]},"raw_data":{"FileName":"vpc.tf","StartLine":278,"EndLine":298}},{"address":"local_file.userdata_compiled","mode":"managed","type":"local_file","name":"userdata_compiled","provider_config_key":"local","expressions":{"content":{"references":["path.root","var.vault_version","var.main_project_tag","var.domain_name","aws_kms_key.seal","data.aws_region.current","var.dynamodb_table_name","aws_s3_bucket.vault_data"]},"filename":{"references":["path.root"]}},"schema_version":0,"raw_data":{"FileName":"outputs.tf","StartLine":2,"EndLine":13}},{"address":"local_file.vault_credentials","mode":"managed","type":"local_file","name":"vault_credentials","provider_config_key":"local","expressions":{"content":{"references":["path.root","var.aws_profile","data.aws_region.current","aws_s3_bucket.vault_data","aws_kms_key.seal","aws_lb.alb"]},"filename":{"references":["path.root"]}},"schema_version":0,"raw_data":{"FileName":"outputs.tf","StartLine":16,"EndLine":25}},{"address":"data.aws_availability_zones.available","mode":"data","type":"aws_availability_zones","name":"available","provider_config_key":"aws","expressions":{"state":{"constant_value":"available"}},"schema_version":0,"raw_data":{"FileName":"aws-data.tf","StartLine":1,"EndLine":3}},{"address":"data.aws_caller_identity.current","mode":"data","type":"aws_caller_identity","name":"current","provider_config_key":"aws","schema_version":0,"raw_data":{"FileName":"aws-data.tf","StartLine":7,"EndLine":7}},{"address":"data.aws_iam_policy_document.asg_trust_policy","mode":"data","type":"aws_iam_policy_document","name":"asg_trust_policy","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["sts:AssumeRole"]},"effect":{"constant_value":"Allow"},"principals":[{"identifiers":{"constant_value":["ec2.amazonaws.com"]},"type":{"constant_value":"Service"}}]}]},"schema_version":0,"raw_data":{"FileName":"iam-policies.tf","StartLine":81,"EndLine":92}},{"address":"data.aws_iam_policy_document.dynamodb_vault_policy","mode":"data","type":"aws_iam_policy_document","name":"dynamodb_vault_policy","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["dynamodb:BatchGetItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:DescribeTable","dynamodb:DeleteItem","dynamodb:GetItem","dynamodb:ListTagsOfResource","dynamodb:UpdateItem","dynamodb:DescribeTimeToLive"]},"effect":{"constant_value":"Allow"},"resources":{"references":["aws_dynamodb_table.vault_storage"]},"sid":{"constant_value":"ManageTable"}},{"actions":{"constant_value":["dynamodb:GetRecords"]},"effect":{"constant_value":"Allow"},"resources":{"references":["aws_dynamodb_table.vault_storage"]},"sid":{"constant_value":"GetStreamRecords"}},{"actions":{"constant_value":["dynamodb:Scan","dynamodb:Query"]},"effect":{"constant_value":"Allow"},"resources":{"references":["aws_dynamodb_table.vault_storage","aws_dynamodb_table.vault_storage"]},"sid":{"constant_value":"QueryAndScanTable"}}]},"schema_version":0,"raw_data":{"FileName":"iam-policies.tf","StartLine":20,"EndLine":63}},{"address":"data.aws_iam_policy_document.kms_vault_policy","mode":"data","type":"aws_iam_policy_document","name":"kms_vault_policy","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["kms:Decrypt","kms:Encrypt","kms:DescribeKey"]},"effect":{"constant_value":"Allow"},"resources":{"references":["aws_kms_key.seal"]},"sid":{"constant_value":"EncryptDecryptAndDescribe"}}]},"schema_version":0,"raw_data":{"FileName":"iam-policies.tf","StartLine":4,"EndLine":17}},{"address":"data.aws_iam_policy_document.s3_vault_policy","mode":"data","type":"aws_iam_policy_document","name":"s3_vault_policy","provider_config_key":"aws","expressions":{"statement":[{"actions":{"constant_value":["s3:PutObject"]},"effect":{"constant_value":"Allow"},"resources":{"references":["aws_s3_bucket.vault_data"]},"sid":{"constant_value":"PutObjects"}}]},"schema_version":0,"raw_data":{"FileName":"iam-policies.tf","StartLine":67,"EndLine":78}},{"address":"data.aws_region.current","mode":"data","type":"aws_region","name":"current","provider_config_key":"aws","schema_version":0,"raw_data":{"FileName":"aws-data.tf","StartLine":5,"EndLine":5}},{"address":"data.aws_ssm_parameter.latest_ami","mode":"data","type":"aws_ssm_parameter","name":"latest_ami","provider_config_key":"aws","expressions":{"name":{"constant_value":"/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2"}},"schema_version":0,"raw_data":{"FileName":"ec2-data.tf","StartLine":3,"EndLine":5}},{"address":"data.aws_vpc.peered_vpc","mode":"data","type":"aws_vpc","name":"peered_vpc","provider_config_key":"aws","expressions":{"id":{"references":["var.peered_vpc_ids","count.index"]}},"schema_version":0,"count_expression":{"references":["var.private_mode","var.peered_vpc_ids","var.peered_vpc_ids"]},"raw_data":{"FileName":"vpc.tf","StartLine":271,"EndLine":275}},{"address":"data.aws_vpc_endpoint_service.dynamodb","mode":"data","type":"aws_vpc_endpoint_service","name":"dynamodb","provider_config_key":"aws","expressions":{"service":{"constant_value":"dynamodb"}},"schema_version":0,"raw_data":{"FileName":"vpc.tf","StartLine":242,"EndLine":244}},{"address":"data.aws_vpc_endpoint_service.kms","mode":"data","type":"aws_vpc_endpoint_service","name":"kms","provider_config_key":"aws","expressions":{"service":{"constant_value":"kms"}},"schema_version":0,"raw_data":{"FileName":"vpc.tf","StartLine":218,"EndLine":220}}],"variables":{"allowed_bastion_cidr_blocks":{"default":["0.0.0.0/0"],"description":"List of CIDR blocks allowed to access your Bastion.  Defaults to EVERYWHERE.  You should probably limit this to your organization IP or VPC CIDR."},"allowed_bastion_cidr_blocks_ipv6":{"default":[],"description":"List of CIDR blocks allowed to access your Bastion.  Defaults to none."},"allowed_traffic_cidr_blocks":{"default":["0.0.0.0/0"],"description":"List of CIDR blocks allowed to send requests to your vault endpoint.  Defaults to EVERYWHERE.  You should probably limit this to your organization IP or VPC CIDR."},"allowed_traffic_cidr_blocks_ipv6":{"default":["::/0"],"description":"List of IPv6 CIDR blocks allowed to send requests to your vault endpoint.  Defaults to EVERYWHERE.  Set to an empty list if not required."},"aws_default_region":{"default":"us-east-1","description":"The default AWS region to deploy the Vault infrastructure to."},"aws_profile":{"default":"default","description":"The AWS Profile to use for this project."},"domain_name":{"description":"Domain name for which you've provisioned an SSL certificate via AWS Certificate Manager.  Example: secrets.examples.com.  Do not include the protocol (i.e. https://)."},"dynamodb_table_name":{"default":"vault_storage","description":"Name of the DynamoDB Table used for the Vault Storage Backend."},"ec2_key_pair_name":{"description":"Name of an existing EC2 Key Pair that exists in the same region as your vault deployment.  Needs to be made separately."},"kms_tags":{"default":{},"description":"Tags for the KMS key used to seal and unseal the Vault."},"main_project_tag":{"default":"vault-deployment","description":"Tag that will be attached to all resources."},"operator_mode":{"default":true,"description":"Enable a NAT Gateway and Bastion for operator access into the Vault Instances."},"peered_vpc_ids":{"default":[],"description":"A list of of a VPC IDs that can access the Vault VPC and thus access vault privately."},"private_mode":{"default":false,"description":"Whether or not the Vault deployment should be private."},"use_lastest_ami":{"default":false,"description":"Whether or not to use the latest version of Amazon Linux 2.  Defaults to false and uses a version that is known to work with this deployment."},"vault_instance_count":{"default":2,"description":"The number of EC2 instances to launch as vault instances.  Should be no less than 2."},"vault_instance_type":{"default":"t2.medium","description":"The EC2 instance size of the vault instances."},"vault_version":{"default":"1.4.0","description":"Version of vault to use."},"vpc_cidr":{"default":"10.255.0.0/20","description":"Cidr block for the VPC.  Using a /16 or /20 Subnet Mask is recommended."},"vpc_instance_tenancy":{"default":"default","description":"Tenancy for instances launched into the VPC."},"vpc_private_subnet_count":{"default":2,"description":"The number of private subnets to create.  Cannot exceed the number of AZs in your selected region."},"vpc_public_subnet_count":{"default":2,"description":"The number of public subnets to create.  Cannot exceed the number of AZs in your selected region.  2 is more than enough."},"vpc_tags":{"default":{},"description":"Additional tags to add to the VPC and its resources."}}}}}
